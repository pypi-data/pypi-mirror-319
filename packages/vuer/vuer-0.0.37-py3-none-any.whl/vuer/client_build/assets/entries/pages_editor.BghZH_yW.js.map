{"version":3,"file":"pages_editor.BghZH_yW.js","sources":["../../../../pages/editor/+Page.tsx"],"sourcesContent":["import { Helmet } from '@vuer-ai/react-helmet-async';\nimport './index.scss';\nimport * as VUER from '@vuer-ai/vuer';\nimport {\n  Combine, ContribLoader,\n  GraphView,\n  Grid,\n  Hands,\n  HemisphereLightStage,\n  PlaybackBar,\n  PlaybackProvider,\n  PlaybackStateProvider,\n  Resizable,\n  ResizableSwitch,\n  SceneContainer,\n  SceneFileDropContainer,\n  Timeline,\n  TimelineFileDrop,\n  TimelineStateProvider,\n  usePlayback,\n  useSceneStore,\n  useSocket,\n  WebSocketProvider,\n} from '@vuer-ai/vuer';\nimport { Leva } from 'leva';\n\n/** inject globals for plugins */\nimport React, { useEffect, useMemo } from 'react';\nimport * as FIBER from '@react-three/fiber';\nimport ReactDOM from 'react-dom';\nimport * as THREE from 'three';\nimport * as JSX from 'react/jsx-runtime';\nimport * as Drei from '@react-three/drei';\nimport * as XR from '@react-three/xr';\n\n// import { HandActuator } from '@vuer-ai/mujoco-ts';\n// console.log(HandActuator);\n\ndeclare global {\n  interface Window {\n    React: typeof React;\n    ReactDOM: typeof ReactDOM;\n    VUER: typeof VUER;\n    THREE: typeof THREE;\n    JSX: typeof JSX;\n    FIBER: typeof FIBER;\n    XR: typeof XR;\n    Drei: typeof Drei;\n  }\n}\n\nif (typeof window !== 'undefined') {\n  window.React = React;\n  window.ReactDOM = ReactDOM;\n  window.VUER = VUER;\n  window.THREE = THREE;\n  window.JSX = JSX;\n  window.FIBER = FIBER;\n  window.XR = XR;\n  window.Drei = Drei;\n}\n\nfunction VuerPlayback() {\n  const playback = usePlayback();\n  const { downlink } = useSocket();\n\n  useEffect(() => {\n    if (!playback) return;\n    const cancel = [\n      downlink.subscribe('SET', playback.addKeyFrame),\n      downlink.subscribe('ADD', playback.addKeyFrame),\n      downlink.subscribe('UPDATE', playback.addKeyFrame),\n      downlink.subscribe('UPSERT', playback.addKeyFrame),\n      downlink.subscribe('REMOVE', playback.addKeyFrame),\n    ];\n\n    return () => {\n      cancel.forEach((f) => f());\n    };\n  }, [playback, downlink]);\n\n  const combinedStream = useMemo(() => {\n    if (!playback?.store) return downlink;\n    return new Combine(downlink, playback.store);\n  }, [downlink, playback?.store]);\n\n  if (!playback) {\n    return (\n      <SceneFileDropContainer\n        stream={combinedStream}\n        style={{\n          display: 'flex',\n          flexDirection: 'row',\n        }}\n        innerStyle={{\n          display: 'flex',\n          flexDirection: 'row',\n        }}\n      >\n        <SceneContainer\n          frameloop=\"always\"\n          stream={downlink}\n          bgChildren={[\n            <HemisphereLightStage key=\"default-light-stage\" />,\n            <Hands key=\"default-hands\" fps={30} stream />,\n          ]}\n        >\n          <ContribLoader\n            _key=\"contrib-loader-mujoco\"\n            prodOnly\n            library=\"@vuer-ai/mujoco-ts\"\n            version=\"0.0.24\"\n            main=\"dist/index.umd.js\"\n          />\n          <Grid key=\"default-grid\" _key=\"default-grid\" />\n        </SceneContainer>\n      </SceneFileDropContainer>\n    );\n  } else\n    return (\n      <ResizableSwitch\n        offset={200}\n        minOffset={48}\n        hidden={true}\n        style={{\n          width: '100%',\n          height: '100%',\n        }}\n      >\n        <SceneFileDropContainer\n          stream={combinedStream}\n          prompt={'scene files supported: *.urdf *.pcd *.ply *.splat'}\n          style={{\n            display: 'flex',\n            flexDirection: 'row',\n          }}\n          innerStyle={{\n            display: 'flex',\n            flexDirection: 'row',\n          }}\n        >\n          <SceneContainer\n            frameloop=\"always\"\n            stream={combinedStream}\n            bgChildren={[\n              <HemisphereLightStage key=\"default-light-stage\" />,\n              <Hands key=\"default-hands\" fps={30} stream />,\n            ]}\n          >\n            <ContribLoader\n              _key=\"contrib-loader-mujoco\"\n              prodOnly\n              library=\"@vuer-ai/mujoco-ts\"\n              version=\"0.0.24\"\n              main=\"dist/index.umd.js\"\n            />\n            <Grid key=\"default-grid\" _key=\"default-grid\" />\n          </SceneContainer>\n        </SceneFileDropContainer>\n        <>\n          <PlaybackStateProvider>\n            <TimelineStateProvider>\n              <PlaybackBar />\n              <TimelineFileDrop>\n                <Timeline />\n                {/*{clips.map((clip, i)=>{*/}\n                {/*  return <Clip {...clip} onDrag onSelectStart onSelectEnd/>*/}\n                {/*})}*/}\n              </TimelineFileDrop>\n            </TimelineStateProvider>\n          </PlaybackStateProvider>\n        </>\n        <PlaybackStateProvider>\n          <TimelineStateProvider>\n            <PlaybackBar />\n          </TimelineStateProvider>\n        </PlaybackStateProvider>\n      </ResizableSwitch>\n    );\n}\n\nfunction SidePanelView() {\n  // this is excessive. triggers when position/rotation changes too.\n  // const scene = useSceneStore(({ children, bgChildren, rawChildren }) =>\n  //   ({ children, bgChildren, rawChildren }));\n  const children = useSceneStore(({ children }) => children);\n  const sceneOps = useSceneStore(({ ops }) => ops);\n  // return <VuerPlayback />;\n\n  return (\n    <Resizable vertical offset={-200} hidden={true}>\n      <VuerPlayback />\n      <GraphView title=\"Scene Graph\" nodes={children} sceneOps={sceneOps} />\n    </Resizable>\n  );\n}\n\nexport default function Page() {\n  const isSSR = typeof window === 'undefined';\n\n  return (\n    <>\n      <Helmet>\n        <title>Vuer Editor</title>\n      </Helmet>\n      <main>\n        <PlaybackProvider>\n          {isSSR ? null : (\n            <WebSocketProvider>\n              {/*<VuerPlayback />*/}\n              <SidePanelView />\n            </WebSocketProvider>\n          )}\n        </PlaybackProvider>\n        <Leva\n          theme={{\n            sizes: {\n              rootWidth: '380px',\n              controlWidth: '200px',\n              numberInputMinWidth: '56px',\n            },\n          }}\n        />\n      </main>\n    </>\n  );\n}\n"],"names":["React","ReactDOM","VUER","THREE","JSX","FIBER","XR","Drei","VuerPlayback","playback","usePlayback","downlink","useSocket","useEffect","cancel","f","combinedStream","useMemo","Combine","jsxs","ResizableSwitch","jsx","SceneFileDropContainer","SceneContainer","HemisphereLightStage","Hands","ContribLoader","Grid","Fragment","PlaybackStateProvider","TimelineStateProvider","PlaybackBar","TimelineFileDrop","Timeline","SidePanelView","children","useSceneStore","sceneOps","ops","Resizable","GraphView","Page","isSSR","Helmet","PlaybackProvider","WebSocketProvider","Leva"],"mappings":"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"}