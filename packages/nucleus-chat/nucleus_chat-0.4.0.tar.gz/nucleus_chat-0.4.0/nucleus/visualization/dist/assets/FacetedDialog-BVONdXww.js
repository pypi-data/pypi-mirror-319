import{m as L,o as H,a as I,R as e,aK as G,T as $,bi as B,u as x,ab as O,ac as M,bj as A,bk as K,bl as z,aJ as T,d as V,bm as j,bn as P,c as R,b2 as U,bo as q,aC as J,aB as Q,bh as X,D as Y}from"./index-Bm2SqMk3.js";import{S as W}from"./SanitizedHTML-CjJss1eo.js";import{C as _}from"./Clear-DseTcK22.js";import{S as Z,T as ee}from"./HierarchicalTrackSelector-DF2QQB2B.js";const te=L()(r=>({facet:{margin:0,marginLeft:r.spacing(2)},select:{marginBottom:r.spacing(2)}}));function ne({onClick:r}){return e.createElement(O,{title:"Clear selection on this facet filter"},e.createElement(M,{onClick:()=>{r()},size:"small"},e.createElement(_,null)))}function ae({visible:r,onClick:n}){return e.createElement(O,{title:"Minimize/expand this facet filter"},e.createElement(M,{onClick:()=>{n()},size:"small"},r?e.createElement(A,null):e.createElement(K,null)))}const le=H(function({column:r,vals:n,model:h}){const{classes:s}=te(),[d,E]=I.useState(!0),{faceted:m}=h,{filters:u}=m,{field:i}=r;return e.createElement(G,{className:s.facet,fullWidth:!0},e.createElement("div",null,e.createElement($,{component:"span"},i),e.createElement(ne,{onClick:()=>{m.setFilter(i,[])}}),e.createElement(ae,{visible:d,onClick:()=>{E(!d)}})),d?e.createElement(B,{multiple:!0,native:!0,className:s.select,value:u.get(r.field)||[],onChange:c=>{m.setFilter(r.field,[...c.target.options].filter(f=>f.selected).map(f=>f.value))}},n.sort((c,f)=>c[0].localeCompare(f[0])).map(([c,f])=>e.createElement("option",{key:c,value:c},x.coarseStripHTML(c)," (",f,")"))):null)}),re=H(function({rows:r,columns:n,model:h}){var s,d;const{faceted:E}=h,{filters:m}=E,u=n.slice(1),i=new Map(u.map(l=>[l.field,new Map])),c=E.filters.keys(),f=u.map(l=>l.field),b=new Set;for(const l of c)!((s=m.get(l))===null||s===void 0)&&s.length&&b.add(l);for(const l of f)b.add(l);let C=r;for(const l of b){const w=i.get(l);for(const g of C){const k=z(l,g),v=w.get(k);k&&(v===void 0?w.set(k,1):w.set(k,v+1))}const S=!((d=m.get(l))===null||d===void 0)&&d.length?new Set(m.get(l)):void 0;C=C.filter(g=>S!==void 0?S.has(z(l,g)):!0)}return e.createElement("div",null,u.map(l=>e.createElement(le,{key:l.field,vals:[...i.get(l.field)],column:l,model:h})))});function oe({model:r}){const{faceted:n}=r,[h,s]=I.useState(null),{showOptions:d,showFilters:E,showSparse:m,useShoppingCart:u}=n;return e.createElement(e.Fragment,null,e.createElement(T,{container:!0,spacing:4,alignItems:"center"},e.createElement(T,{item:!0},e.createElement(V,{label:"Search...",value:n.filterText,onChange:i=>{n.setFilterText(i.target.value)},slotProps:{input:{endAdornment:e.createElement(j,{position:"end"},e.createElement(M,{onClick:()=>{n.setFilterText("")}},e.createElement(_,null)))}}})),e.createElement(T,{item:!0},e.createElement(M,{onClick:i=>{s(i.currentTarget)}},e.createElement(P,null))),e.createElement(T,{item:!0},e.createElement(Z,{model:r}))),e.createElement(R.Menu,{anchorEl:h,open:!!h,onClose:()=>{s(null)},onMenuItemClick:(i,c)=>{c(),s(null)},menuItems:[{label:"Add tracks to selection instead of turning them on/off",onClick:()=>{n.setUseShoppingCart(!u)},type:"checkbox",checked:u},{label:"Show sparse metadata columns",onClick:()=>{n.setShowSparse(!m)},checked:m,type:"checkbox"},{label:"Show facet filters",onClick:()=>{n.setShowFilters(!E)},checked:E,type:"checkbox"},{label:"Show extra table options",onClick:()=>{n.setShowOptions(!d)},checked:d,type:"checkbox"}]}))}const se=L()({cell:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},resizeHandle:{marginLeft:5,background:"grey",width:5}}),F=.75,ie=H(function({model:n}){var h;const{classes:s}=se(),{view:d,selection:E,shownTrackIds:m,faceted:u}=n,{rows:i,panelWidth:c,showFilters:f,useShoppingCart:b,showOptions:C,filteredRows:l,filteredNonMetadataKeys:w,filteredMetadataKeys:S,visible:g}=u,{pluginManager:k}=x.getEnv(n),[v,D]=I.useState({name:x.measureGridWidth(i.map(t=>t.name),{maxWidth:500,stripHTML:!0})+15,...Object.fromEntries(w.filter(t=>g[t]).map(t=>[t,x.measureGridWidth(i.map(o=>o[t]),{maxWidth:400,stripHTML:!0})])),...Object.fromEntries(S.filter(t=>g[`metadata.${t}`]).map(t=>[`metadata.${t}`,x.measureGridWidth(i.map(o=>o.metadata[t]),{maxWidth:400,stripHTML:!0})]))}),N=[{field:"name",hideable:!1,renderCell:t=>{const{value:o,row:p}=t,{id:a,conf:y}=p;return e.createElement("div",{className:s.cell},e.createElement(W,{html:o}),e.createElement(ee,{id:a,conf:y,trackId:a,model:n}))},width:(h=v.name)!==null&&h!==void 0?h:100},...w.map(t=>{var o;return{field:t,width:(o=v[t])!==null&&o!==void 0?o:100,renderCell:p=>{const a=p.value;return a?e.createElement(W,{className:s.cell,html:a}):""}}}),...S.map(t=>{var o;return{field:`metadata.${t}`,headerName:["name",...w].includes(t)?`${t} (from metadata)`:t,width:(o=v[`metadata.${t}`])!==null&&o!==void 0?o:100,valueGetter:(p,a)=>{var y;return`${(y=a.metadata[t])!==null&&y!==void 0?y:""}`},renderCell:p=>{const a=p.value;return a?e.createElement(W,{className:s.cell,html:a}):""}}})];return e.createElement(e.Fragment,null,e.createElement(oe,{model:n}),e.createElement("div",{style:{display:"flex",overflow:"hidden",height:window.innerHeight*F,width:window.innerWidth*F}},e.createElement("div",{style:{height:window.innerHeight*F,width:window.innerWidth*F-(f?c:0)}},e.createElement(U,{rows:l,onColumnWidthChange:t=>{D({...v,[t.colDef.field]:t.width})},columnVisibilityModel:g,onColumnVisibilityModelChange:t=>{u.setVisible(t)},columnHeaderHeight:35,checkboxSelection:!0,disableRowSelectionOnClick:!0,keepNonExistentRowsSelected:!0,onRowSelectionModelChange:t=>{if(b){const o=J(n),p=k.pluggableConfigSchemaType("track");n.setSelection(t.map(a=>Q(p,o,a)))}else{const o=m,p=new Set(t);q(()=>{[...o].filter(a=>!p.has(a)).map(a=>d.hideTrack(a)),[...p].filter(a=>!o.has(a)).map(a=>{d.showTrack(a),n.addToRecentlyUsed(a)})})}},rowSelectionModel:b?E.map(t=>t.trackId):[...m],slots:{toolbar:C?X:null},slotProps:{toolbar:{printOptions:{disableToolbarButton:!0}}},columns:N,rowHeight:25})),f?e.createElement(e.Fragment,null,e.createElement(R.ResizeHandle,{vertical:!0,onDrag:t=>u.setPanelWidth(c-t),className:s.resizeHandle}),e.createElement("div",{style:{width:c,overflow:"auto"}},e.createElement(re,{model:n,rows:i,columns:N}))):null))}),fe=H(function(r){const{handleClose:n}=r;return e.createElement(R.Dialog,{open:!0,onClose:n,maxWidth:"xl",title:"Faceted track selector"},e.createElement(Y,null,e.createElement(ie,{...r})))});export{fe as default};
