import{r as i,u as p,V as S,ab as A,R as e,b as m,E as F,F as x,a as o,ae as M,af as $,G as j,K as D,m as T}from"./rpcWorker-CVTx5FIM.js";const B=T()(r=>({textAreaFont:{fontFamily:"Courier New"},mgap:{display:"flex",flexDirection:"column",gap:r.spacing(4)}}));function P({model:r,handleClose:l}){const{classes:g}=B(),[s,v]=i.useState(),[E,c]=i.useState(),[y,w]=i.useState("");return i.useEffect(()=>{(async()=>{try{c(void 0);const n=p.getContainingView(r);if(!n.initialized)return;const{rpcManager:t}=p.getSession(r),{sources:a,mafFilter:b,adapterConfig:C}=r,f=S.getRpcSessionId(r),d=await t.call(f,"MultiVariantGetGenotypeMatrix",{regions:n.dynamicBlocks.contentBlocks,sources:a,mafFilter:b,sessionId:f,adapterConfig:C}),h=Object.values(d),R=Object.keys(d),k=`try(library(fastcluster), silent=TRUE)
inputMatrix<-matrix(c(${h.map(u=>u.genotypes.join(",")).join(`,
`)}
),nrow=${h.length},byrow=TRUE)
rownames(inputMatrix)<-c(${R.map(u=>`'${u}'`).join(",")})
resultClusters<-hclust(dist(inputMatrix), method='single')
cat(resultClusters$order,sep='\\n')`;v(k)}catch(n){!p.isAbortException(n)&&A(r)&&(console.error(n),c(n))}})()},[r]),e.createElement(m.Dialog,{open:!0,title:"Cluster by genotype",onClose:l},e.createElement(F,null,e.createElement("div",{className:g.mgap},e.createElement(x,null,"This page will produce an R script that will perform hierarchical clustering on the visible genotype data using `hclust`."),e.createElement(x,null,"You can then paste the results in this form to specify the row ordering."),s?e.createElement("div",null,e.createElement("div",null,"Step 1:"," ",e.createElement(o,{variant:"contained",onClick:()=>{M.saveAs(new Blob([s||""],{type:"text/plain;charset=utf-8"}),"cluster.R")}},"Download Rscript")," ","or"," ",e.createElement(o,{variant:"contained",onClick:()=>{$(s||"")}},"Copy Rscript to clipboard"),e.createElement("div",null,e.createElement(j,{multiline:!0,fullWidth:!0,variant:"outlined",placeholder:"Step 2. Paste results from Rscript here (sequence of numbers, one per line, specifying the new ordering)",rows:10,value:y,onChange:n=>{w(n.target.value)},slotProps:{input:{classes:{input:g.textAreaFont}}}})))):e.createElement(m.LoadingEllipses,{variant:"h6",title:"Generating genotype matrix"}),E?e.createElement(m.ErrorMessage,{error:E}):null)),e.createElement(D,null,e.createElement(o,{disabled:!s,variant:"contained",onClick:()=>{const{sources:n}=r;if(n)try{r.setLayout(y.split(`
`).map(t=>t.trim()).filter(t=>!!t).map(t=>+t).map(t=>{const a=n[t-1];if(!a)throw new Error(`out of bounds at ${t}`);return a}))}catch(t){console.error(t),c(t)}l()}},"Apply clustering"),e.createElement(o,{variant:"contained",color:"secondary",onClick:()=>{l()}},"Cancel")))}export{P as default};
