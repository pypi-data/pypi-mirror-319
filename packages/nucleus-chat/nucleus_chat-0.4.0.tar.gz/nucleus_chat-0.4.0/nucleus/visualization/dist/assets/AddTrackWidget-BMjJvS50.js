import{m as h,o as k,r as m,R as e,P as U,bE as B,bF as H,bG as V,am as K,an as $,G as S,bj as L,ai as J,bh as z,u as p,bH as Q,M,F as b,a2 as N,V as Y,b as C,aQ as j,I as X,J as Z,aJ as _,bA as ee,bB as te,bC as ae,bD as ne,a as D,bs as re,c as se,bf as ce,bI as le}from"./rpcWorker-CVTx5FIM.js";import{D as oe}from"./Delete-yZ2st8Ox.js";const ie=h()(t=>({paper:{display:"flex",flexDirection:"column",padding:t.spacing(1)},card:{marginTop:t.spacing(1)}})),ue=k(function({model:t}){const{classes:a}=ie(),[r,c]=m.useState(""),[s,l]=m.useState(""),[n,i]=m.useState(["Name","ID"]),[o,d]=m.useState(["CDS","exon"]),E=[{label:"Indexing attributes",values:n},{label:"Feature types to exclude",values:o}];return m.useEffect(()=>{t.setTextIndexingConf({attributes:n,exclude:o})},[t,n,o]),e.createElement(U,{className:a.paper},e.createElement(B,null,"Indexing configuration"),E.map((f,g)=>e.createElement(H,{raised:!0,key:f.label,className:a.card},e.createElement(V,null,e.createElement(B,null,f.label),e.createElement(K,{disablePadding:!0},f.values.map((u,v)=>e.createElement($,{key:`${u}-${v}`,disableGutters:!0},e.createElement(S,{value:u,slotProps:{input:{endAdornment:e.createElement(L,{position:"end"},e.createElement(J,{onClick:()=>{const x=f.values.filter((W,w)=>w!==v);g===0?i(x):d(x)}},e.createElement(oe,null)))}}}))),e.createElement($,{disableGutters:!0},e.createElement(S,{value:g===0?r:s,placeholder:"add new",onChange:u=>{g===0?c(u.target.value):l(u.target.value)},slotProps:{input:{endAdornment:e.createElement(L,{position:"end"},e.createElement(J,{onClick:()=>{g===0?(i([...n,r]),c("")):(d([...o,s]),l(""))},disabled:g===0?r==="":s==="","data-testid":"stringArrayAdd-Feat"},e.createElement(z,null)))}}})))))))}),pe=h()(t=>({spacing:{marginBottom:t.spacing(3)}}));function de(t){const a={};return t.forEach(r=>{var c;const s=((c=r.adapterMetadata)===null||c===void 0?void 0:c.category)||"Default";a[s]||(a[s]=[]),a[s].push(r)}),a}const G=k(({model:t})=>{const{classes:a}=pe(),{trackAdapter:r}=t,{pluginManager:c}=p.getEnv(t);return e.createElement(S,{className:a.spacing,value:(r==null?void 0:r.type)!=="UNKNOWN"?r==null?void 0:r.type:"",label:"Adapter type",variant:"outlined",helperText:"Select an adapter type",select:!0,fullWidth:!0,onChange:s=>{t.setAdapterHint(s.target.value)},slotProps:{select:{SelectDisplayProps:{"data-testid":"adapterTypeSelect"}}}},Object.entries(de(c.getAdapterElements().filter(s=>{var l;return!(!((l=s.adapterMetadata)===null||l===void 0)&&l.hiddenFromGUI)}))).map(([s,l])=>[e.createElement(Q,{key:s},s),l.map(n=>e.createElement(M,{key:n.name,value:n.name},n.displayName))]))}),me=h()(t=>({spacing:{marginBottom:t.spacing(3)}})),ge=k(({model:t})=>{const{classes:a}=me(),{pluginManager:r}=p.getEnv(t),{trackType:c}=t,s=r.getTrackElements();return e.createElement(S,{className:a.spacing,value:c,variant:"outlined",label:"Track type",helperText:"Select track type",select:!0,fullWidth:!0,onChange:l=>{t.setTrackType(l.target.value)},slotProps:{select:{SelectDisplayProps:{"data-testid":"trackTypeSelect"}}}},s.map(({name:l,displayName:n})=>e.createElement(M,{key:l,value:l},n)))}),P=h()(t=>({spacing:{marginBottom:t.spacing(3)}}));function fe({trackAdapter:t,trackType:a}){const{classes:r}=P(),{type:c,subadapter:s}=t;return c==="SNPCoverageAdapter"?e.createElement(b,{className:r.spacing},"Selected ",e.createElement("code",null,a),". Using adapter ",e.createElement("code",null,c)," with subadapter ",e.createElement("code",null,s==null?void 0:s.type),". Please enter a track name and, if necessary, update the track type."):e.createElement(b,{className:r.spacing},"Using adapter ",e.createElement("code",null,c)," and guessing track type"," ",e.createElement("code",null,a),". Please enter a track name and, if necessary, update the track type.")}function ke({model:t}){const{classes:a}=P();return e.createElement(e.Fragment,null,e.createElement(b,{className:a.spacing},"JBrowse was not able to guess the adapter type for this data, but it may be in the list below. If not, you can"," ",e.createElement(N,{href:"https://github.com/GMOD/jbrowse-components/releases",target:"_blank",rel:"noopener noreferrer"},"check for new releases")," ","of JBrowse to see if they support this data type or"," ",e.createElement(N,{href:"https://github.com/GMOD/jbrowse-components/issues/new",target:"_blank",rel:"noopener noreferrer"},"file an issue")," ","and add a feature request for this data type."),e.createElement(G,{model:t}))}const Ee=k(function({model:a}){const{classes:r}=P(),[c,s]=m.useState(!0),l=p.getSession(a),{trackName:n,unsupported:i,trackAdapter:o,trackType:d,warningMessage:E,adapterHint:f}=a;if(m.useEffect(()=>{f===""&&o&&a.setAdapterHint(o.type)},[f,o,o==null?void 0:o.type,a]),i)return e.createElement(b,{className:r.spacing},"This version of JBrowse cannot display data of this type. It is possible, however, that there is a newer version that can display them. You can"," ",e.createElement(N,{href:"https://github.com/GMOD/jbrowse-components/releases",target:"_blank",rel:"noopener noreferrer"},"check for new releases")," ","of JBrowse or"," ",e.createElement(N,{href:"https://github.com/GMOD/jbrowse-components/issues/new",target:"_blank",rel:"noopener noreferrer"},"file an issue")," ","and add a feature request for this data type.");if((o==null?void 0:o.type)===Y.UNKNOWN)return e.createElement(ke,{model:a});if(!(o!=null&&o.type))return e.createElement(b,null,"Could not recognize this data type.");const g=p.isSupportedIndexingAdapter(o.type);return e.createElement("div",null,e.createElement(fe,{trackAdapter:o,trackType:d}),E?e.createElement(b,{style:{color:"orange"}},E):null,e.createElement(S,{className:r.spacing,label:"trackName",helperText:"A name for this track",fullWidth:!0,value:n,onChange:u=>{a.setTrackName(u.target.value)},slotProps:{htmlInput:{"data-testid":"trackNameInput"}}}),e.createElement(G,{model:a}),e.createElement(ge,{model:a}),e.createElement(C.AssemblySelector,{session:l,helperText:"Select assembly to add track to",selected:a.assembly,onChange:u=>{a.setAssembly(u)},TextFieldProps:{fullWidth:!0,SelectProps:{SelectDisplayProps:{"data-testid":"assemblyNameSelect"}}}}),p.isElectron&&g&&e.createElement(j,null,e.createElement(X,{label:"Index track for text searching?",control:e.createElement(Z,{checked:c,onChange:u=>{s(u.target.checked),a.setTextIndexTrack(u.target.checked)}})})),p.isElectron&&c&&g?e.createElement(ue,{model:a}):null)}),ye=h()(t=>({paper:{padding:t.spacing(2)},spacer:{height:t.spacing(8)}})),be=k(function({model:t}){const{classes:a}=ye(),r=_(t);return e.createElement(U,{className:a.paper},e.createElement(C.FileSelector,{name:"Main file",description:"",location:t.trackData,setLocation:t.setTrackData,setName:t.setTrackName,rootModel:r}),e.createElement("div",{className:a.spacer}),e.createElement(C.FileSelector,{name:"Index file",description:"(Optional) The URL of the index file is automatically inferred from the URL of the main file if it is not supplied.",location:t.indexTrackData,setLocation:t.setIndexTrackData,setName:t.setTrackName,rootModel:r}))}),he=h()(t=>({root:{marginTop:t.spacing(1)},stepper:{backgroundColor:t.palette.background.default},button:{marginRight:t.spacing(1)},actionsContainer:{marginTop:t.spacing(10),marginBottom:t.spacing(2)},alertContainer:{padding:`${t.spacing(2)}px 0px ${t.spacing(2)}px 0px`}})),I=["Enter track data","Confirm track type"],ve=k(function({model:t}){const[a,r]=m.useState(0),{classes:c}=he(),{jobsManager:s}=_(t),l=p.getSession(t),{assembly:n,trackAdapter:i,trackData:o,trackName:d,trackType:E,textIndexTrack:f,textIndexingConf:g}=t,[u,v]=m.useState();function x(y){switch(y){case 0:return e.createElement(be,{model:t});case 1:return e.createElement(Ee,{model:t});default:return e.createElement(b,null,"Unknown step")}}async function W(){var y,T;if(a!==I.length-1){r(a+1);return}const A=[`${d.toLowerCase().replaceAll(" ","_")}-${Date.now()}`,l.adminMode?"":"-sessionTrack"].join(""),F=l.assemblyManager.get(n);if(!p.isSessionWithAddTracks(l)){v("Unable to add tracks to this model");return}if(F&&i&&i.type!=="UNKNOWN"){if(l.addTrackConf({trackId:A,type:E,name:d,assemblyNames:[n],adapter:{...i,sequenceAdapter:se.getConf(F,["sequence","adapter"])}}),(T=(y=t.view).showTrack)===null||T===void 0||T.call(y,A),p.isElectron&&f&&p.isSupportedIndexingAdapter(i.type)){const R=g||{attributes:["Name","ID"],exclude:["CDS","exon"]},O=`${d}-index`,q={indexingParams:{...R,assemblies:[n],tracks:[A],indexType:"perTrack",name:O,timestamp:new Date().toISOString()},name:O,cancelCallback:()=>s.abortJob()};s.queueJob(q)}t.clearData(),p.isSessionModelWithWidgets(l)&&l.hideWidget(t)}else v(`Failed to add track.
The configuration of this file is not currently supported.`)}function w(){switch(a){case 0:return!o;case 1:return!(d&&E&&(i!=null&&i.type)&&n);default:return!0}}return e.createElement("div",{className:c.root},e.createElement(ee,{className:c.stepper,activeStep:a,orientation:"vertical"},I.map((y,T)=>e.createElement(te,{key:y},e.createElement(ae,null,y),e.createElement(ne,null,x(T),e.createElement("div",{className:c.actionsContainer},e.createElement(D,{disabled:a===0,onClick:()=>{v(void 0),r(a-1)},className:c.button},"Back"),e.createElement(D,{disabled:w(),variant:"contained",color:"primary",onClick:W,className:c.button,"data-testid":"addTrackNextButton"},a===I.length-1?"Add":"Next")),u?e.createElement("div",{className:c.alertContainer},e.createElement(re,{severity:"error"},u)):null)))))}),Se=h()({textbox:{width:"100%"},submit:{marginTop:25,marginBottom:100,display:"block"}}),Te=k(function({model:t}){const{classes:a}=Se(),[r,c]=m.useState(""),[s,l]=m.useState();return e.createElement("div",null,s?e.createElement(C.ErrorMessage,{error:s}):null,e.createElement(S,{multiline:!0,rows:10,value:r,onChange:n=>{c(n.target.value)},placeholder:"Paste track config or array of track configs in JSON format",variant:"outlined",className:a.textbox}),e.createElement(D,{variant:"contained",className:a.submit,onClick:()=>{try{l(void 0);const n=p.getSession(t),i=JSON.parse(r),o=Array.isArray(i)?i:[i];p.isSessionWithAddTracks(n)&&p.isSessionModelWithWidgets(n)&&(o.forEach(d=>{n.addTrackConf(d)}),o.forEach(d=>t.view.showTrack(d.trackId)),t.clearData(),n.hideWidget(t))}catch(n){console.error(n),l(n)}}},"Submit"))}),Ce=k(function({model:t}){const[a,r]=m.useState("Default add track workflow"),c={"Default add track workflow":ve,"Add track JSON":Te,...Object.fromEntries(p.getEnv(t).pluginManager.getAddTrackWorkflowElements().map(n=>[n.name,n.ReactComponent]))},s=c[a]?a:"Default add track workflow",l=c[s];return e.createElement(e.Fragment,null,e.createElement(j,null,e.createElement(ce,{value:s,onChange:n=>{r(n.target.value)}},Object.keys(c).map(n=>e.createElement(M,{key:n,value:n},n))),e.createElement(le,null,"Type of add track workflow")),e.createElement(m.Suspense,{fallback:null},e.createElement(l,{model:t})))});export{Ce as default};
