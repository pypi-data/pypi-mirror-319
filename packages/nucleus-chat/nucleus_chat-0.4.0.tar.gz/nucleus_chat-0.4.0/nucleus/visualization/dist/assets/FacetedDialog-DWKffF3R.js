import{m as G,o as H,r as I,R as e,aQ as $,F as D,bf as A,u as x,T as L,ai as M,bg as B,bh as V,bi as z,aP as T,G as K,bj as P,bk as j,b as R,b4 as U,bl as q,aJ as J,aI as Q,be as X,E as Y}from"./rpcWorker-CVTx5FIM.js";import{S as W}from"./SanitizedHTML-CwPuJFfG.js";import{C as O}from"./Clear-By4xHTFM.js";import{S as Z,T as ee}from"./HierarchicalTrackSelector-vXtRKMUG.js";const te=G()(r=>({facet:{margin:0,marginLeft:r.spacing(2)},select:{marginBottom:r.spacing(2)}}));function ne({onClick:r}){return e.createElement(L,{title:"Clear selection on this facet filter"},e.createElement(M,{onClick:()=>{r()},size:"small"},e.createElement(O,null)))}function ae({visible:r,onClick:n}){return e.createElement(L,{title:"Minimize/expand this facet filter"},e.createElement(M,{onClick:()=>{n()},size:"small"},r?e.createElement(B,null):e.createElement(V,null)))}const le=H(function({column:r,vals:n,model:h}){const{classes:i}=te(),[d,E]=I.useState(!0),{faceted:m}=h,{filters:u}=m,{field:s}=r;return e.createElement($,{className:i.facet,fullWidth:!0},e.createElement("div",null,e.createElement(D,{component:"span"},s),e.createElement(ne,{onClick:()=>{m.setFilter(s,[])}}),e.createElement(ae,{visible:d,onClick:()=>{E(!d)}})),d?e.createElement(A,{multiple:!0,native:!0,className:i.select,value:u.get(r.field)||[],onChange:c=>{m.setFilter(r.field,[...c.target.options].filter(f=>f.selected).map(f=>f.value))}},n.sort((c,f)=>c[0].localeCompare(f[0])).map(([c,f])=>e.createElement("option",{key:c,value:c},x.coarseStripHTML(c)," (",f,")"))):null)}),re=H(function({rows:r,columns:n,model:h}){var i,d;const{faceted:E}=h,{filters:m}=E,u=n.slice(1),s=new Map(u.map(l=>[l.field,new Map])),c=E.filters.keys(),f=u.map(l=>l.field),b=new Set;for(const l of c)!((i=m.get(l))===null||i===void 0)&&i.length&&b.add(l);for(const l of f)b.add(l);let S=r;for(const l of b){const w=s.get(l);for(const g of S){const k=z(l,g),v=w.get(k);k&&(v===void 0?w.set(k,1):w.set(k,v+1))}const C=!((d=m.get(l))===null||d===void 0)&&d.length?new Set(m.get(l)):void 0;S=S.filter(g=>C!==void 0?C.has(z(l,g)):!0)}return e.createElement("div",null,u.map(l=>e.createElement(le,{key:l.field,vals:[...s.get(l.field)],column:l,model:h})))});function oe({model:r}){const{faceted:n}=r,[h,i]=I.useState(null),{showOptions:d,showFilters:E,showSparse:m,useShoppingCart:u}=n;return e.createElement(e.Fragment,null,e.createElement(T,{container:!0,spacing:4,alignItems:"center"},e.createElement(T,{item:!0},e.createElement(K,{label:"Search...",value:n.filterText,onChange:s=>{n.setFilterText(s.target.value)},slotProps:{input:{endAdornment:e.createElement(P,{position:"end"},e.createElement(M,{onClick:()=>{n.setFilterText("")}},e.createElement(O,null)))}}})),e.createElement(T,{item:!0},e.createElement(M,{onClick:s=>{i(s.currentTarget)}},e.createElement(j,null))),e.createElement(T,{item:!0},e.createElement(Z,{model:r}))),e.createElement(R.Menu,{anchorEl:h,open:!!h,onClose:()=>{i(null)},onMenuItemClick:(s,c)=>{c(),i(null)},menuItems:[{label:"Add tracks to selection instead of turning them on/off",onClick:()=>{n.setUseShoppingCart(!u)},type:"checkbox",checked:u},{label:"Show sparse metadata columns",onClick:()=>{n.setShowSparse(!m)},checked:m,type:"checkbox"},{label:"Show facet filters",onClick:()=>{n.setShowFilters(!E)},checked:E,type:"checkbox"},{label:"Show extra table options",onClick:()=>{n.setShowOptions(!d)},checked:d,type:"checkbox"}]}))}const ie=G()({cell:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},resizeHandle:{marginLeft:5,background:"grey",width:5}}),F=.75,se=H(function({model:n}){var h;const{classes:i}=ie(),{view:d,selection:E,shownTrackIds:m,faceted:u}=n,{rows:s,panelWidth:c,showFilters:f,useShoppingCart:b,showOptions:S,filteredRows:l,filteredNonMetadataKeys:w,filteredMetadataKeys:C,visible:g}=u,{pluginManager:k}=x.getEnv(n),[v,_]=I.useState({name:x.measureGridWidth(s.map(t=>t.name),{maxWidth:500,stripHTML:!0})+15,...Object.fromEntries(w.filter(t=>g[t]).map(t=>[t,x.measureGridWidth(s.map(o=>o[t]),{maxWidth:400,stripHTML:!0})])),...Object.fromEntries(C.filter(t=>g[`metadata.${t}`]).map(t=>[`metadata.${t}`,x.measureGridWidth(s.map(o=>o.metadata[t]),{maxWidth:400,stripHTML:!0})]))}),N=[{field:"name",hideable:!1,renderCell:t=>{const{value:o,row:p}=t,{id:a,conf:y}=p;return e.createElement("div",{className:i.cell},e.createElement(W,{html:o}),e.createElement(ee,{id:a,conf:y,trackId:a,model:n}))},width:(h=v.name)!==null&&h!==void 0?h:100},...w.map(t=>{var o;return{field:t,width:(o=v[t])!==null&&o!==void 0?o:100,renderCell:p=>{const a=p.value;return a?e.createElement(W,{className:i.cell,html:a}):""}}}),...C.map(t=>{var o;return{field:`metadata.${t}`,headerName:["name",...w].includes(t)?`${t} (from metadata)`:t,width:(o=v[`metadata.${t}`])!==null&&o!==void 0?o:100,valueGetter:(p,a)=>{var y;return`${(y=a.metadata[t])!==null&&y!==void 0?y:""}`},renderCell:p=>{const a=p.value;return a?e.createElement(W,{className:i.cell,html:a}):""}}})];return e.createElement(e.Fragment,null,e.createElement(oe,{model:n}),e.createElement("div",{style:{display:"flex",overflow:"hidden",height:window.innerHeight*F,width:window.innerWidth*F}},e.createElement("div",{style:{height:window.innerHeight*F,width:window.innerWidth*F-(f?c:0)}},e.createElement(U,{rows:l,onColumnWidthChange:t=>{_({...v,[t.colDef.field]:t.width})},columnVisibilityModel:g,onColumnVisibilityModelChange:t=>{u.setVisible(t)},columnHeaderHeight:35,checkboxSelection:!0,disableRowSelectionOnClick:!0,keepNonExistentRowsSelected:!0,onRowSelectionModelChange:t=>{if(b){const o=J(n),p=k.pluggableConfigSchemaType("track");n.setSelection(t.map(a=>Q(p,o,a)))}else{const o=m,p=new Set(t);q(()=>{[...o].filter(a=>!p.has(a)).map(a=>d.hideTrack(a)),[...p].filter(a=>!o.has(a)).map(a=>{d.showTrack(a),n.addToRecentlyUsed(a)})})}},rowSelectionModel:b?E.map(t=>t.trackId):[...m],slots:{toolbar:S?X:null},slotProps:{toolbar:{printOptions:{disableToolbarButton:!0}}},columns:N,rowHeight:25})),f?e.createElement(e.Fragment,null,e.createElement(R.ResizeHandle,{vertical:!0,onDrag:t=>u.setPanelWidth(c-t),className:i.resizeHandle}),e.createElement("div",{style:{width:c,overflow:"auto"}},e.createElement(re,{model:n,rows:s,columns:N}))):null))}),fe=H(function(r){const{handleClose:n}=r;return e.createElement(R.Dialog,{open:!0,onClose:n,maxWidth:"xl",title:"Faceted track selector"},e.createElement(Y,null,e.createElement(se,{...r})))});export{fe as default};
