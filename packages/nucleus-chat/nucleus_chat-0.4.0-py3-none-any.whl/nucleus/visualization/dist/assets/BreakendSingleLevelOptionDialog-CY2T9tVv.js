import{m as x,R as l,I as M,J as F,az as V,L as _,u as b,o as P,r as S,b as B,E as T,K as O,a as E,X as A,G as I}from"./rpcWorker-CVTx5FIM.js";const j=x()({block:{display:"block"}});function C({checked:e,disabled:c,label:o,onChange:a}){const{classes:n}=j();return l.createElement(M,{disabled:c,className:n.block,control:l.createElement(F,{checked:e,onChange:a}),label:o})}function G(e){return e.map(({id:c,displays:o,...a})=>({...a,displays:o.map(({id:n,...r})=>r)}))}function z({feature:e,assembly:c}){var o;const a=(o=e.get("ALT"))===null||o===void 0?void 0:o[0],n=a?V(a):void 0,r=e.get("start"),d=e.get("refName"),s=i=>c.getCanonicalRefName(i)||i;if(a==="<TRA>"){const i=e.get("INFO");return{pos:r,refName:s(d),mateRefName:s(i.CHR2[0]),matePos:i.END[0]-1}}else if(n!=null&&n.MatePosition){const i=n.MatePosition.split(":");return{pos:r,refName:s(d),mateRefName:s(i[0]),matePos:+i[1]-1}}else if(e.get("mate")){const i=e.get("mate");return{pos:r,refName:s(d),mateRefName:s(i.refName),matePos:i.start}}else return{pos:r,refName:s(d),mateRefName:s(d),matePos:e.get("end")}}function H({feature:e,session:c,assemblyName:o}){const{assemblyManager:a}=c,n=a.get(o);if(!n)throw new Error(`assembly ${o} not found`);if(!n.regions)throw new Error(`assembly ${o} regions not loaded`);const r=z({feature:e,assembly:n}),{refName:d,mateRefName:s}=r,i=n.regions.find(t=>t.refName===d),f=n.regions.find(t=>t.refName===s);return{coverage:r,snap:{type:"BreakpointSplitView",views:[{type:"LinearGenomeView",displayedRegions:b.gatherOverlaps([{...i,assemblyName:o},{...f,assemblyName:o}])}],displayName:`${e.get("name")||e.get("id")||"breakend"} split detail`}}}async function K({stableViewId:e,feature:c,assemblyName:o,session:a,tracks:n,windowSize:r=0}){var d;const{snap:s,coverage:i}=H({feature:c,assemblyName:o,session:a}),{refName:f,pos:t,mateRefName:v,matePos:k}=i;let g=a.views.find(p=>p.id===e);g?((d=g.views[0])===null||d===void 0||d.setDisplayedRegions(s.views[0].displayedRegions),g.setDisplayName(s.displayName)):g=a.addView("BreakpointSplitView",{...s,views:[{...s.views[0],tracks:n?G(_(n)):[]}]});const m=g.views[0];await b.when(()=>m.initialized);const u=m.bpToPx({coord:Math.max(0,t-r),refName:f}),w=m.bpToPx({coord:k+r,refName:v});u&&w?m.moveTo({...u,offset:u.offsetPx},{...w,offset:w.offsetPx}):b.getSession(m).notify("Unable to navigate to breakpoint")}function R(e){return e.map(({id:c,displays:o,...a})=>({...a,displays:o.map(({id:n,...r})=>r)}))}const D=P(function({session:e,handleClose:c,feature:o,assemblyName:a,stableViewId:n,view:r}){const[d,s]=S.useState(!0),[i,f]=S.useState(!0);return l.createElement(B.Dialog,{open:!0,onClose:c,title:"Multi-level breakpoint split view options"},l.createElement(T,null,l.createElement("div",null,"Launch multi-level breakpoint split view"),r?l.createElement(l.Fragment,null,l.createElement(C,{checked:d,label:"Copy tracks into the new view",onChange:t=>{s(t.target.checked)}}),d?l.createElement(C,{checked:i,disabled:!d,label:"Mirror the copied tracks (only available if copying tracks and using two level)",onChange:t=>{f(t.target.checked)}}):null):null),l.createElement(O,null,l.createElement(E,{onClick:()=>{(async()=>{try{const{assemblyManager:t}=e,v=await t.waitForAssembly(a);if(!v)throw new Error(`assembly ${a} not found`);const{refName:k,pos:g,mateRefName:m,matePos:u}=z({feature:o,assembly:v}),w=r?_(r.tracks):[];let p=e.views.find(y=>y.id===n);const L=`${o.get("name")||o.get("id")||"breakend"} split detail`;p||(p=e.addView("BreakpointSplitView",{id:n,type:"BreakpointSplitView",displayName:L,views:[{type:"LinearGenomeView",hideHeader:!0,tracks:R(w)},{type:"LinearGenomeView",hideHeader:!0,tracks:R(i?[...w].reverse():w)}]})),p.setDisplayName(L);const h=v.regions.find(y=>y.refName===k),N=v.regions.find(y=>y.refName===m);if(!h||!N)throw new Error("can't find regions");await Promise.all([p.views[0].navToLocations([{refName:k,start:h.start,end:g,assemblyName:a},{refName:k,start:g+1,end:h.end,assemblyName:a}]),p.views[1].navToLocations([{refName:m,start:N.start,end:u,assemblyName:a},{refName:m,start:u+1,end:N.end,assemblyName:a}])]),await A(()=>p.views[1].initialized&&p.views[0].initialized),p.views[1].zoomTo(10),p.views[0].zoomTo(10),p.views[1].centerAt(u,m),p.views[0].centerAt(g,k)}catch(t){console.error(t),e.notifyError(`${t}`,t)}})(),c()},variant:"contained",color:"primary",autoFocus:!0},"OK"),l.createElement(E,{color:"secondary",variant:"contained",onClick:()=>{c()}},"Cancel")))}),$=P(function({session:e,handleClose:c,feature:o,stableViewId:a,assemblyName:n,view:r}){const[d,s]=S.useState(!0),[i,f]=b.useLocalStorage("breakpointWindowSize","5000");return l.createElement(B.Dialog,{open:!0,onClose:c,title:"Single-level breakpoint split view options"},l.createElement(T,null,r?l.createElement(C,{checked:d,label:"Copy tracks into the new view",onChange:t=>{s(t.target.checked)}}):null,l.createElement(I,{label:"Window size (bp)",value:i,onChange:t=>{f(t.target.value)}})),l.createElement(O,null,l.createElement(E,{onClick:()=>{(async()=>{try{const{assemblyManager:t}=e;if(!await t.waitForAssembly(n))throw new Error(`assembly ${n} not found`);await K({feature:o,assemblyName:n,session:e,stableViewId:a,tracks:r==null?void 0:r.tracks,windowSize:+i||0})}catch(t){console.error(t),e.notifyError(`${t}`,t)}})(),c()},variant:"contained",color:"primary",autoFocus:!0},"OK"),l.createElement(E,{color:"secondary",variant:"contained",onClick:()=>{c()}},"Cancel")))});var J=Object.freeze({__proto__:null,default:D}),U=Object.freeze({__proto__:null,default:$}),X=Object.freeze({__proto__:null,default:D}),q=Object.freeze({__proto__:null,default:$});export{J as B,U as a,X as b,q as c};
