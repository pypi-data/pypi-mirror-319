import{r as C,m as D,o as w,u as E,R as u,cj as Xe,bh as Ye,ck as Ze,M as ve,aW as N,aX as A,aY as F,g as O,cl as Z,c as Ae,cm as ce,V as Qe,T as ue,G as et,bj as tt,ai as Fe,cn as de,co as L,cp as fe,cq as rt,cr as nt,cs as it,ct as at,F as st,I as ot,J as lt}from"./rpcWorker-CVTx5FIM.js";import{C as ct}from"./Clear-By4xHTFM.js";import{S as He}from"./SanitizedHTML-CwPuJFfG.js";let x;typeof window<"u"?x=window:typeof self<"u"?x=self:x=global;let se=null,oe=null;const _e=20,te=x.clearTimeout,Se=x.setTimeout,re=x.cancelAnimationFrame||x.mozCancelAnimationFrame||x.webkitCancelAnimationFrame,be=x.requestAnimationFrame||x.mozRequestAnimationFrame||x.webkitRequestAnimationFrame;re==null||be==null?(se=te,oe=function(e){return Se(e,_e)}):(se=function([e,t]){re(e),te(t)},oe=function(e){const t=be(function(){te(n),e()}),n=Se(function(){re(t),e()},_e);return[t,n]});function ut(r){let e,t,n,a,s,o,l;const h=typeof document<"u"&&document.attachEvent;if(!h){o=function(d){const m=d.__resizeTriggers__,g=m.firstElementChild,y=m.lastElementChild,b=g.firstElementChild;y.scrollLeft=y.scrollWidth,y.scrollTop=y.scrollHeight,b.style.width=g.offsetWidth+1+"px",b.style.height=g.offsetHeight+1+"px",g.scrollLeft=g.scrollWidth,g.scrollTop=g.scrollHeight},s=function(d){return d.offsetWidth!==d.__resizeLast__.width||d.offsetHeight!==d.__resizeLast__.height},l=function(d){if(d.target.className&&typeof d.target.className.indexOf=="function"&&d.target.className.indexOf("contract-trigger")<0&&d.target.className.indexOf("expand-trigger")<0)return;const m=this;o(this),this.__resizeRAF__&&se(this.__resizeRAF__),this.__resizeRAF__=oe(function(){s(m)&&(m.__resizeLast__.width=m.offsetWidth,m.__resizeLast__.height=m.offsetHeight,m.__resizeListeners__.forEach(function(b){b.call(m,d)}))})};let c=!1,v="";n="animationstart";const I="Webkit Moz O ms".split(" ");let i="webkitAnimationStart animationstart oAnimationStart MSAnimationStart".split(" "),f="";{const d=document.createElement("fakeelement");if(d.style.animationName!==void 0&&(c=!0),c===!1){for(let m=0;m<I.length;m++)if(d.style[I[m]+"AnimationName"]!==void 0){f=I[m],v="-"+f.toLowerCase()+"-",n=i[m],c=!0;break}}}t="resizeanim",e="@"+v+"keyframes "+t+" { from { opacity: 0; } to { opacity: 0; } } ",a=v+"animation: 1ms "+t+"; "}const p=function(c){if(!c.getElementById("detectElementResize")){const v=(e||"")+".resize-triggers { "+(a||"")+'visibility: hidden; opacity: 0; } .resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; z-index: -1; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',I=c.head||c.getElementsByTagName("head")[0],i=c.createElement("style");i.id="detectElementResize",i.type="text/css",r!=null&&i.setAttribute("nonce",r),i.styleSheet?i.styleSheet.cssText=v:i.appendChild(c.createTextNode(v)),I.appendChild(i)}};return{addResizeListener:function(c,v){if(h)c.attachEvent("onresize",v);else{if(!c.__resizeTriggers__){const I=c.ownerDocument,i=x.getComputedStyle(c);i&&i.position==="static"&&(c.style.position="relative"),p(I),c.__resizeLast__={},c.__resizeListeners__=[],(c.__resizeTriggers__=I.createElement("div")).className="resize-triggers";const f=I.createElement("div");f.className="expand-trigger",f.appendChild(I.createElement("div"));const d=I.createElement("div");d.className="contract-trigger",c.__resizeTriggers__.appendChild(f),c.__resizeTriggers__.appendChild(d),c.appendChild(c.__resizeTriggers__),o(c),c.addEventListener("scroll",l,!0),n&&(c.__resizeTriggers__.__animationListener__=function(g){g.animationName===t&&o(c)},c.__resizeTriggers__.addEventListener(n,c.__resizeTriggers__.__animationListener__))}c.__resizeListeners__.push(v)}},removeResizeListener:function(c,v){if(h)c.detachEvent("onresize",v);else if(c.__resizeListeners__.splice(c.__resizeListeners__.indexOf(v),1),!c.__resizeListeners__.length){c.removeEventListener("scroll",l,!0),c.__resizeTriggers__.__animationListener__&&(c.__resizeTriggers__.removeEventListener(n,c.__resizeTriggers__.__animationListener__),c.__resizeTriggers__.__animationListener__=null);try{c.__resizeTriggers__=!c.removeChild(c.__resizeTriggers__)}catch{}}}}}class dt extends C.Component{constructor(...e){super(...e),this.state={height:this.props.defaultHeight||0,scaledHeight:this.props.defaultHeight||0,scaledWidth:this.props.defaultWidth||0,width:this.props.defaultWidth||0},this._autoSizer=null,this._detectElementResize=null,this._parentNode=null,this._resizeObserver=null,this._timeoutId=null,this._onResize=()=>{this._timeoutId=null;const{disableHeight:t,disableWidth:n,onResize:a}=this.props;if(this._parentNode){const s=window.getComputedStyle(this._parentNode)||{},o=parseFloat(s.paddingLeft||"0"),l=parseFloat(s.paddingRight||"0"),h=parseFloat(s.paddingTop||"0"),p=parseFloat(s.paddingBottom||"0"),_=this._parentNode.getBoundingClientRect(),S=_.height-h-p,c=_.width-o-l,v=this._parentNode.offsetHeight-h-p,I=this._parentNode.offsetWidth-o-l;(!t&&(this.state.height!==v||this.state.scaledHeight!==S)||!n&&(this.state.width!==I||this.state.scaledWidth!==c))&&(this.setState({height:v,width:I,scaledHeight:S,scaledWidth:c}),typeof a=="function"&&a({height:v,scaledHeight:S,scaledWidth:c,width:I}))}},this._setRef=t=>{this._autoSizer=t}}componentDidMount(){const{nonce:e}=this.props,t=this._autoSizer?this._autoSizer.parentNode:null;if(t!=null&&t.ownerDocument&&t.ownerDocument.defaultView&&t instanceof t.ownerDocument.defaultView.HTMLElement){this._parentNode=t;const n=t.ownerDocument.defaultView.ResizeObserver;n!=null?(this._resizeObserver=new n(()=>{this._timeoutId=setTimeout(this._onResize,0)}),this._resizeObserver.observe(t)):(this._detectElementResize=ut(e),this._detectElementResize.addResizeListener(t,this._onResize)),this._onResize()}}componentWillUnmount(){this._parentNode&&(this._detectElementResize&&this._detectElementResize.removeResizeListener(this._parentNode,this._onResize),this._timeoutId!==null&&clearTimeout(this._timeoutId),this._resizeObserver&&this._resizeObserver.disconnect())}render(){const{children:e,defaultHeight:t,defaultWidth:n,disableHeight:a=!1,disableWidth:s=!1,doNotBailOutOnEmptyChildren:o=!1,nonce:l,onResize:h,style:p={},tagName:_="div",...S}=this.props,{height:c,scaledHeight:v,scaledWidth:I,width:i}=this.state,f={overflow:"visible"},d={};let m=!1;return a||(c===0&&(m=!0),f.height=0,d.height=c,d.scaledHeight=v),s||(i===0&&(m=!0),f.width=0,d.width=i,d.scaledWidth=I),o&&(m=!1),C.createElement(_,{ref:this._setRef,style:{...f,...p},...S},!m&&e(d))}}const ft=D()(r=>({fab:{position:"absolute",bottom:r.spacing(6),right:r.spacing(6)}})),ht=w(function({model:r}){const{classes:e}=ft(),t=E.getSession(r),[n,a]=C.useState(null);function s(){a(null)}const o=E.isSessionModelWithConnections(t),l=E.isSessionWithAddTracks(t);return l||o?u.createElement(u.Fragment,null,u.createElement(Xe,{color:"secondary",className:e.fab,onClick:h=>{a(h.currentTarget)}},u.createElement(Ye,null)),u.createElement(Ze,{anchorEl:n,open:!!n,onClose:()=>{a(null)}},o?u.createElement(ve,{onClick:()=>{s(),E.isSessionModelWithWidgets(t)&&t.showWidget(t.addWidget("AddConnectionWidget","addConnectionWidget"))}},"Add connection"):null,l?u.createElement(ve,{onClick:()=>{s(),E.isSessionModelWithWidgets(t)&&t.showWidget(t.addWidget("AddTrackWidget","addTrackWidget",{view:r.view.id}))}},"Add track"):null)):null});var j={},ye;function mt(){if(ye)return j;ye=1;var r=N();Object.defineProperty(j,"__esModule",{value:!0}),j.default=void 0;var e=r(A()),t=F();return j.default=(0,e.default)((0,t.jsx)("path",{d:"M3 18h18v-2H3zm0-5h18v-2H3zm0-7v2h18V6z"}),"Menu"),j}var gt=mt(),pt=O(gt);const vt=C.lazy(()=>import("./FacetedDialog-DWKffF3R.js")),_t=C.lazy(()=>import("./CloseConnectionDialog-vhduWsT9.js")),St=C.lazy(()=>import("./DeleteConnectionDialog-CGbopai9.js")),bt=C.lazy(()=>import("./ManageConnectionsDialog-d29cJugJ.js")),yt=C.lazy(()=>import("./ToggleConnectionsDialog-DKERMCuz.js")),It=w(function({model:r}){const e=E.getSession(r),[t,n]=C.useState(),[a,s]=C.useState(),[o,l]=C.useState(!1),[h,p]=C.useState(!1),[_,S]=C.useState(!1);function c(v,I){var i;const f=Ae.readConfObject(v,"name"),d=(i=e.prepareToBreakConnection)===null||i===void 0?void 0:i.call(e,v);if(d){const[m,g]=d;Object.keys(g).length>0?n({connectionConf:v,safelyBreakConnection:m,dereferenceTypeCount:g,name:f}):m()}I&&s({name:f,connectionConf:v})}return u.createElement(u.Fragment,null,u.createElement(Z,{menuItems:[{label:"Open faceted track selector",onClick:()=>{S(!0)}},...E.isSessionWithAddTracks(e)?[{label:"Add track...",onClick:()=>{E.isSessionModelWithWidgets(e)&&e.showWidget(e.addWidget("AddTrackWidget","addTrackWidget",{view:r.view.id}))}}]:[],{label:"Connections...",subMenu:[...E.isSessionModelWithConnections(e)?[{label:"Turn on/off connections...",onClick:()=>{l(!0)}}]:[],...E.isSessionModelWithConnectionEditing(e)?[{label:"Add connection...",onClick:()=>{E.isSessionModelWithWidgets(e)&&e.showWidget(e.addWidget("AddConnectionWidget","addConnectionWidget"))}},{label:"Delete connections...",onClick:()=>{p(!0)}}]:[]]},{label:"Sort...",type:"subMenu",subMenu:[{label:"Sort tracks by name",type:"checkbox",checked:r.activeSortTrackNames,onClick:()=>{r.setSortTrackNames(!r.activeSortTrackNames)}},{label:"Sort categories by name",type:"checkbox",checked:r.activeSortCategories,onClick:()=>{r.setSortCategories(!r.activeSortCategories)}}]},{label:"Collapse...",type:"subMenu",subMenu:[...r.hasAnySubcategories?[{label:"Collapse subcategories",onClick:()=>{r.collapseSubCategories()}}]:[],{label:"Collapse top-level categories",onClick:()=>{r.collapseTopLevelCategories()}},{label:"Expand all categories",onClick:()=>{r.expandAllCategories()}}]}]},u.createElement(pt,null)),u.createElement(C.Suspense,{fallback:null},t?u.createElement(_t,{modalInfo:t,onClose:()=>{n(void 0)}}):null,a?u.createElement(St,{handleClose:()=>{s(void 0)},deleteDialogDetails:a,session:e}):null,h?u.createElement(bt,{handleClose:()=>{p(!1)},breakConnection:c,session:e}):null,o?u.createElement(yt,{handleClose:()=>{l(!1)},session:e,breakConnection:c}):null,_?u.createElement(vt,{handleClose:()=>{S(!1)},model:r}):null))});var U={},Ie;function Tt(){if(Ie)return U;Ie=1;var r=N();Object.defineProperty(U,"__esModule",{value:!0}),U.default=void 0;var e=r(A()),t=F();return U.default=(0,e.default)((0,t.jsx)("path",{d:"M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2M1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2"}),"ShoppingCart"),U}var Ct=Tt(),kt=O(Ct);const Et=w(function({model:r}){const{selection:e}=r,{pluginManager:t}=E.getEnv(r),n=E.getSession(r),a=t.evaluateExtensionPoint("TrackSelector-multiTrackMenuItems",[],{session:n});return e.length?u.createElement(Z,{menuItems:[{label:"Clear",onClick:()=>{r.clearSelection()}},...a.map(s=>({...s,..."onClick"in s?{onClick:()=>{s.onClick(r)}}:{}}))]},u.createElement(ce,{badgeContent:e.length,color:"primary"},u.createElement(kt,null))):null});var V={},Te;function zt(){if(Te)return V;Te=1;var r=N();Object.defineProperty(V,"__esModule",{value:!0}),V.default=void 0;var e=r(A()),t=F();return V.default=(0,e.default)((0,t.jsx)("path",{d:"M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"}),"Grade"),V}var xt=zt(),Mt=O(xt),G={},Ce;function wt(){if(Ce)return G;Ce=1;var r=N();Object.defineProperty(G,"__esModule",{value:!0}),G.default=void 0;var e=r(A()),t=F();return G.default=(0,e.default)((0,t.jsx)("path",{d:"M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreHoriz"),G}var Ot=wt(),qe=O(Ot),K={},ke;function Rt(){if(ke)return K;ke=1;var r=N();Object.defineProperty(K,"__esModule",{value:!0}),K.default=void 0;var e=r(A()),t=F();return K.default=(0,e.default)((0,t.jsx)("path",{d:"M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"}),"Star"),K}var Wt=Rt(),Dt=O(Wt),J={},Ee;function Lt(){if(Ee)return J;Ee=1;var r=N();Object.defineProperty(J,"__esModule",{value:!0}),J.default=void 0;var e=r(A()),t=F();return J.default=(0,e.default)((0,t.jsx)("path",{d:"m22 9.24-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28z"}),"StarBorderOutlined"),J}var Nt=Lt(),At=O(Nt);const Ft=D()({cascadingStyle:{padding:0}}),$e=function({id:r,trackId:e,stopPropagation:t,model:n,setOpen:a,conf:s}){var o,l;const{classes:h}=Ft();return u.createElement(Z,{className:h.cascadingStyle,stopPropagation:t,setOpen:a,"data-testid":`htsTrackEntryMenu-${r}`,menuItems:[...((l=(o=E.getSession(n)).getTrackActionMenuItems)===null||l===void 0?void 0:l.call(o,s))||[],n.isFavorite(e)?{label:"Remove from favorites",onClick:()=>{n.removeFromFavorites(e)},icon:At}:{label:"Add to favorites",onClick:()=>{n.addToFavorites(e)},icon:Dt},{label:"Add to selection",onClick:()=>{n.addToSelection([s])}},...n.isSelected(s)?[{label:"Remove from selection",onClick:()=>{n.removeFromSelection([s])}}]:[]]},u.createElement(qe,null))},Pe=w(function({model:r,tracks:e,extraMenuItems:t,children:n,onClick:a}){const{view:s}=r,[o,l]=C.useState(!1),h=E.getSession(r);return s?u.createElement(Z,{closeAfterItemClick:!1,onClick:a,menuItems:[...e.map(p=>({type:"checkbox",label:u.createElement(u.Fragment,null,u.createElement(He,{html:Qe.getTrackName(p,h)})," ",u.createElement($e,{id:p.trackId,trackId:p.trackId,model:r,conf:p,setOpen:l,stopPropagation:!0})),checked:s.tracks.some(_=>_.configuration===p),onClick:()=>{o||r.view.toggleTrack(p.trackId)&&r.addToRecentlyUsed(p.trackId)}})),...t]},n):null}),Ht=D()({smallBadge:{height:14},margin:{marginRight:10}}),qt=w(function({model:r}){const{classes:e}=Ht(),{view:t,favoriteTracks:n}=r;return t?u.createElement(Pe,{onClick:()=>{r.setFavoritesCounter(0)},tracks:n,model:r,extraMenuItems:n.length?[{type:"divider"},{label:"Clear favorites",onClick:()=>{r.clearFavorites()}}]:[{label:"No favorite tracks yet",onClick:()=>{}}]},u.createElement(ue,{title:"Favorite tracks"},u.createElement(ce,{classes:{badge:e.smallBadge},color:"secondary",anchorOrigin:{vertical:"bottom",horizontal:"right"},className:e.margin,badgeContent:r.favoritesCounter},u.createElement(Mt,null)))):null});var X={},ze;function $t(){if(ze)return X;ze=1;var r=N();Object.defineProperty(X,"__esModule",{value:!0}),X.default=void 0;var e=r(A()),t=F();return X.default=(0,e.default)((0,t.jsx)("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9m-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8z"}),"History"),X}var Pt=$t(),Bt=O(Pt);const jt=D()({smallBadge:{height:14}}),Ut=w(function({model:r}){const{classes:e}=jt(),{view:t,recentlyUsedCounter:n,recentlyUsedTracks:a}=r;return t?u.createElement(Pe,{onClick:()=>{r.setRecentlyUsedCounter(0)},model:r,tracks:a,extraMenuItems:a.length?[{type:"divider"},{label:"Clear recently used",onClick:()=>{r.clearRecentlyUsed()}}]:[{label:"No recently used",onClick:()=>{}}]},u.createElement(ue,{title:"Recently used tracks"},u.createElement(ce,{classes:{badge:e.smallBadge},anchorOrigin:{vertical:"bottom",horizontal:"right"},color:"secondary",badgeContent:n},u.createElement(Bt,null)))):null}),Vt=D()(r=>({searchBox:{margin:r.spacing(2)}})),Gt=w(function({model:r}){const{filterText:e}=r,{classes:t}=Vt();return u.createElement(et,{className:t.searchBox,label:"Filter tracks",value:e,onChange:n=>{r.setFilterText(n.target.value)},fullWidth:!0,slotProps:{input:{endAdornment:u.createElement(tt,{position:"end"},u.createElement(Fe,{onClick:()=>{r.clearFilterText()}},u.createElement(ct,null)))}}})}),Kt=w(function({model:r,setHeaderHeight:e}){return u.createElement("div",{ref:t=>{e((t==null?void 0:t.getBoundingClientRect().height)||0)},"data-testid":"hierarchical_track_selector"},u.createElement("div",{style:{display:"flex"}},u.createElement(It,{model:r}),u.createElement(Et,{model:r}),u.createElement(Gt,{model:r}),u.createElement(Ut,{model:r}),u.createElement(qt,{model:r})))});var xe=Number.isNaN||function(e){return typeof e=="number"&&e!==e};function Jt(r,e){return!!(r===e||xe(r)&&xe(e))}function Xt(r,e){if(r.length!==e.length)return!1;for(var t=0;t<r.length;t++)if(!Jt(r[t],e[t]))return!1;return!0}function ne(r,e){e===void 0&&(e=Xt);var t,n=[],a,s=!1;function o(){for(var l=[],h=0;h<arguments.length;h++)l[h]=arguments[h];return s&&t===this&&e(l,n)||(a=r.apply(this,l),s=!0,t=this,n=l),a}return o}var Yt=typeof performance=="object"&&typeof performance.now=="function",Me=Yt?function(){return performance.now()}:function(){return Date.now()};function we(r){cancelAnimationFrame(r.id)}function Zt(r,e){var t=Me();function n(){Me()-t>=e?r.call(null):a.id=requestAnimationFrame(n)}var a={id:requestAnimationFrame(n)};return a}var ie=-1;function Oe(r){if(r===void 0&&(r=!1),ie===-1||r){var e=document.createElement("div"),t=e.style;t.width="50px",t.height="50px",t.overflow="scroll",document.body.appendChild(e),ie=e.offsetWidth-e.clientWidth,document.body.removeChild(e)}return ie}var $=null;function Re(r){if(r===void 0&&(r=!1),$===null||r){var e=document.createElement("div"),t=e.style;t.width="50px",t.height="50px",t.overflow="scroll",t.direction="rtl";var n=document.createElement("div"),a=n.style;return a.width="100px",a.height="100px",e.appendChild(n),document.body.appendChild(e),e.scrollLeft>0?$="positive-descending":(e.scrollLeft=1,e.scrollLeft===0?$="negative":$="positive-ascending"),document.body.removeChild(e),$}return $}var Qt=150,er=function(e,t){return e};function tr(r){var e,t=r.getItemOffset,n=r.getEstimatedTotalSize,a=r.getItemSize,s=r.getOffsetForIndexAndAlignment,o=r.getStartIndexForOffset,l=r.getStopIndexForStartIndex,h=r.initInstanceProps,p=r.shouldResetStyleCacheOnItemSizeChange,_=r.validateProps;return e=function(S){de(c,S);function c(I){var i;return i=S.call(this,I)||this,i._instanceProps=h(i.props,L(i)),i._outerRef=void 0,i._resetIsScrollingTimeoutId=null,i.state={instance:L(i),isScrolling:!1,scrollDirection:"forward",scrollOffset:typeof i.props.initialScrollOffset=="number"?i.props.initialScrollOffset:0,scrollUpdateWasRequested:!1},i._callOnItemsRendered=void 0,i._callOnItemsRendered=ne(function(f,d,m,g){return i.props.onItemsRendered({overscanStartIndex:f,overscanStopIndex:d,visibleStartIndex:m,visibleStopIndex:g})}),i._callOnScroll=void 0,i._callOnScroll=ne(function(f,d,m){return i.props.onScroll({scrollDirection:f,scrollOffset:d,scrollUpdateWasRequested:m})}),i._getItemStyle=void 0,i._getItemStyle=function(f){var d=i.props,m=d.direction,g=d.itemSize,y=d.layout,b=i._getItemStyleCache(p&&g,p&&y,p&&m),T;if(b.hasOwnProperty(f))T=b[f];else{var k=t(i.props,f,i._instanceProps),M=a(i.props,f,i._instanceProps),z=m==="horizontal"||y==="horizontal",R=m==="rtl",H=z?k:0;b[f]=T={position:"absolute",left:R?void 0:H,right:R?H:void 0,top:z?0:k,height:z?"100%":M,width:z?M:"100%"}}return T},i._getItemStyleCache=void 0,i._getItemStyleCache=ne(function(f,d,m){return{}}),i._onScrollHorizontal=function(f){var d=f.currentTarget,m=d.clientWidth,g=d.scrollLeft,y=d.scrollWidth;i.setState(function(b){if(b.scrollOffset===g)return null;var T=i.props.direction,k=g;if(T==="rtl")switch(Re()){case"negative":k=-g;break;case"positive-descending":k=y-m-g;break}return k=Math.max(0,Math.min(k,y-m)),{isScrolling:!0,scrollDirection:b.scrollOffset<k?"forward":"backward",scrollOffset:k,scrollUpdateWasRequested:!1}},i._resetIsScrollingDebounced)},i._onScrollVertical=function(f){var d=f.currentTarget,m=d.clientHeight,g=d.scrollHeight,y=d.scrollTop;i.setState(function(b){if(b.scrollOffset===y)return null;var T=Math.max(0,Math.min(y,g-m));return{isScrolling:!0,scrollDirection:b.scrollOffset<T?"forward":"backward",scrollOffset:T,scrollUpdateWasRequested:!1}},i._resetIsScrollingDebounced)},i._outerRefSetter=function(f){var d=i.props.outerRef;i._outerRef=f,typeof d=="function"?d(f):d!=null&&typeof d=="object"&&d.hasOwnProperty("current")&&(d.current=f)},i._resetIsScrollingDebounced=function(){i._resetIsScrollingTimeoutId!==null&&we(i._resetIsScrollingTimeoutId),i._resetIsScrollingTimeoutId=Zt(i._resetIsScrolling,Qt)},i._resetIsScrolling=function(){i._resetIsScrollingTimeoutId=null,i.setState({isScrolling:!1},function(){i._getItemStyleCache(-1,null)})},i}c.getDerivedStateFromProps=function(i,f){return rr(i,f),_(i),null};var v=c.prototype;return v.scrollTo=function(i){i=Math.max(0,i),this.setState(function(f){return f.scrollOffset===i?null:{scrollDirection:f.scrollOffset<i?"forward":"backward",scrollOffset:i,scrollUpdateWasRequested:!0}},this._resetIsScrollingDebounced)},v.scrollToItem=function(i,f){f===void 0&&(f="auto");var d=this.props,m=d.itemCount,g=d.layout,y=this.state.scrollOffset;i=Math.max(0,Math.min(i,m-1));var b=0;if(this._outerRef){var T=this._outerRef;g==="vertical"?b=T.scrollWidth>T.clientWidth?Oe():0:b=T.scrollHeight>T.clientHeight?Oe():0}this.scrollTo(s(this.props,i,f,y,this._instanceProps,b))},v.componentDidMount=function(){var i=this.props,f=i.direction,d=i.initialScrollOffset,m=i.layout;if(typeof d=="number"&&this._outerRef!=null){var g=this._outerRef;f==="horizontal"||m==="horizontal"?g.scrollLeft=d:g.scrollTop=d}this._callPropsCallbacks()},v.componentDidUpdate=function(){var i=this.props,f=i.direction,d=i.layout,m=this.state,g=m.scrollOffset,y=m.scrollUpdateWasRequested;if(y&&this._outerRef!=null){var b=this._outerRef;if(f==="horizontal"||d==="horizontal")if(f==="rtl")switch(Re()){case"negative":b.scrollLeft=-g;break;case"positive-ascending":b.scrollLeft=g;break;default:var T=b.clientWidth,k=b.scrollWidth;b.scrollLeft=k-T-g;break}else b.scrollLeft=g;else b.scrollTop=g}this._callPropsCallbacks()},v.componentWillUnmount=function(){this._resetIsScrollingTimeoutId!==null&&we(this._resetIsScrollingTimeoutId)},v.render=function(){var i=this.props,f=i.children,d=i.className,m=i.direction,g=i.height,y=i.innerRef,b=i.innerElementType,T=i.innerTagName,k=i.itemCount,M=i.itemData,z=i.itemKey,R=z===void 0?er:z,H=i.layout,Q=i.outerElementType,q=i.outerTagName,W=i.style,Ue=i.useIsScrolling,Ve=i.width,he=this.state.isScrolling,ee=m==="horizontal"||H==="horizontal",Ge=ee?this._onScrollHorizontal:this._onScrollVertical,me=this._getRangeToRender(),Ke=me[0],Je=me[1],ge=[];if(k>0)for(var B=Ke;B<=Je;B++)ge.push(C.createElement(f,{data:M,key:R(B,M),index:B,isScrolling:Ue?he:void 0,style:this._getItemStyle(B)}));var pe=n(this.props,this._instanceProps);return C.createElement(Q||q||"div",{className:d,onScroll:Ge,ref:this._outerRefSetter,style:fe({position:"relative",height:g,width:Ve,overflow:"auto",WebkitOverflowScrolling:"touch",willChange:"transform",direction:m},W)},C.createElement(b||T||"div",{children:ge,ref:y,style:{height:ee?"100%":pe,pointerEvents:he?"none":void 0,width:ee?pe:"100%"}}))},v._callPropsCallbacks=function(){if(typeof this.props.onItemsRendered=="function"){var i=this.props.itemCount;if(i>0){var f=this._getRangeToRender(),d=f[0],m=f[1],g=f[2],y=f[3];this._callOnItemsRendered(d,m,g,y)}}if(typeof this.props.onScroll=="function"){var b=this.state,T=b.scrollDirection,k=b.scrollOffset,M=b.scrollUpdateWasRequested;this._callOnScroll(T,k,M)}},v._getRangeToRender=function(){var i=this.props,f=i.itemCount,d=i.overscanCount,m=this.state,g=m.isScrolling,y=m.scrollDirection,b=m.scrollOffset;if(f===0)return[0,0,0,0];var T=o(this.props,b,this._instanceProps),k=l(this.props,T,b,this._instanceProps),M=!g||y==="backward"?Math.max(1,d):1,z=!g||y==="forward"?Math.max(1,d):1;return[Math.max(0,T-M),Math.max(0,Math.min(f-1,k+z)),T,k]},c}(C.PureComponent),e.defaultProps={direction:"ltr",itemData:void 0,layout:"vertical",overscanCount:2,useIsScrolling:!1},e}var rr=function(e,t){e.children,e.direction,e.height,e.layout,e.innerTagName,e.outerTagName,e.width,t.instance},nr=50,P=function(e,t,n){var a=e,s=a.itemSize,o=n.itemMetadataMap,l=n.lastMeasuredIndex;if(t>l){var h=0;if(l>=0){var p=o[l];h=p.offset+p.size}for(var _=l+1;_<=t;_++){var S=s(_);o[_]={offset:h,size:S},h+=S}n.lastMeasuredIndex=t}return o[t]},ir=function(e,t,n){var a=t.itemMetadataMap,s=t.lastMeasuredIndex,o=s>0?a[s].offset:0;return o>=n?Be(e,t,s,0,n):ar(e,t,Math.max(0,s),n)},Be=function(e,t,n,a,s){for(;a<=n;){var o=a+Math.floor((n-a)/2),l=P(e,o,t).offset;if(l===s)return o;l<s?a=o+1:l>s&&(n=o-1)}return a>0?a-1:0},ar=function(e,t,n,a){for(var s=e.itemCount,o=1;n<s&&P(e,n,t).offset<a;)n+=o,o*=2;return Be(e,t,Math.min(n,s-1),Math.floor(n/2),a)},We=function(e,t){var n=e.itemCount,a=t.itemMetadataMap,s=t.estimatedItemSize,o=t.lastMeasuredIndex,l=0;if(o>=n&&(o=n-1),o>=0){var h=a[o];l=h.offset+h.size}var p=n-o-1,_=p*s;return l+_},sr=tr({getItemOffset:function(e,t,n){return P(e,t,n).offset},getItemSize:function(e,t,n){return n.itemMetadataMap[t].size},getEstimatedTotalSize:We,getOffsetForIndexAndAlignment:function(e,t,n,a,s,o){var l=e.direction,h=e.height,p=e.layout,_=e.width,S=l==="horizontal"||p==="horizontal",c=S?_:h,v=P(e,t,s),I=We(e,s),i=Math.max(0,Math.min(I-c,v.offset)),f=Math.max(0,v.offset-c+v.size+o);switch(n==="smart"&&(a>=f-c&&a<=i+c?n="auto":n="center"),n){case"start":return i;case"end":return f;case"center":return Math.round(f+(i-f)/2);case"auto":default:return a>=f&&a<=i?a:a<f?f:i}},getStartIndexForOffset:function(e,t,n){return ir(e,n,t)},getStopIndexForStartIndex:function(e,t,n,a){for(var s=e.direction,o=e.height,l=e.itemCount,h=e.layout,p=e.width,_=s==="horizontal"||h==="horizontal",S=_?p:o,c=P(e,t,a),v=n+S,I=c.offset+c.size,i=t;i<l-1&&I<v;)i++,I+=P(e,i,a).size;return i},initInstanceProps:function(e,t){var n=e,a=n.estimatedItemSize,s={itemMetadataMap:{},estimatedItemSize:a||nr,lastMeasuredIndex:-1};return t.resetAfterIndex=function(o,l){l===void 0&&(l=!0),s.lastMeasuredIndex=Math.min(s.lastMeasuredIndex,o-1),t._getItemStyleCache(-1),l&&t.forceUpdate()},s},shouldResetStyleCacheOnItemSizeChange:!1,validateProps:function(e){e.itemSize}});function or(r){return function(e){r.forEach(function(t){typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var ae=function(){},lr=function(e,t){return t===void 0&&(t=null),{child:null,isShown:t?t.public.isOpen&&t.isShown:!0,parent:t,public:e,sibling:null,visited:!1}},cr=function(e,t){var n=t.getRecordData,a=n(e),s=a.data.id;return s},ur=function(e){var t=e.index,n=e.data,a=n.component,s=n.getRecordData,o=n.treeData,l=e.style,h=e.isScrolling,p=s(t);return u.createElement(a,Object.assign({isScrolling:h,style:l,treeData:o},p))},dr=function(e,t,n){var a=e.createRecord,s=t.buildingTaskTimeout,o=t.placeholder,l=t.async,h=l===void 0?!1:l,p=t.treeWalker,_=h&&n.records!==void 0,S=n.records,c=[],v=new Map,I=s?{timeout:s}:void 0,i=new WeakMap,f=p(),d=f.next(),m=d.value,g=a(m.data,n,void 0,_?S.get(m.data.id):void 0);v.set(g.public.data.id,g),i.set(g,m);var y=g,b=!0,T=g,k=o!==void 0&&!(o===null&&!n.order),M=k?function(R){return R.timeRemaining()>0}:function(){return!0},z=function R(H){for(;y!==null;){if(!M(H)){requestIdleCallback(R,I);return}if(y.visited)y.visited=!1,y=y.sibling!==null?y.sibling:y.parent,T=y;else{var Q=f.next(i.get(y)),q=Q.value;if(q===void 0){b?b=!1:(y.isShown&&c.push(y.public.data.id),y.visited=y.child!==null,y=y.child!==null?y.child:y.sibling!==null?y.sibling:y.parent),T=y;continue}var W=a(q.data,n,b?void 0:y,_?S.get(q.data.id):void 0);v.set(W.public.data.id,W),i.set(W,q),!b&&T===y?T.child=W:T.sibling=W,T=W}}k&&n.setState({order:c,records:v,updateRequest:{}})};return k?requestIdleCallback(z,I):z(),o!==void 0&&h&&n.order?n:{order:c,records:v}},De=32768,fr=2,hr=function(e,t){var n=e.order,a=e.records,s=t.opennessState;if(typeof s!="object")return null;for(var o in s)if(a.has(o)){var l=s[o],h=a.get(o),p=typeof l=="boolean"?{open:l}:l,_=p.open,S=p.subtreeCallback,c=S===void 0?ae:S,v=ae,I=ae;h.isShown&&(_?function(){for(var f=n.indexOf(o),d=h;d!==null;){if(d.sibling!==null){d=d.sibling;break}d=d.parent}var m=d===null?n.length-1-f:n.indexOf(d.public.data.id)-1-f,g=[[f+1,m]];v=function(b){if(b.isShown=b.parent?b.parent.public.isOpen&&b.parent.isShown:!0,b.isShown){var T=g[g.length-1];T.push(b.public.data.id),T.length===De+fr&&g.push([f+1+De*g.length,0])}},I=function(){for(var b=0;b<g.length;b++){var T;(T=n).splice.apply(T,g[b])}}}():h.public.isOpen&&function(){var f=n.indexOf(o),d=0;v=function(g){g.isShown&&(d+=1),g.isShown=g.parent?g.parent.public.isOpen&&g.parent.isShown:!0},I=function(){n.splice(f+1,d)}}());for(var i=h;i!==null;)i.visited?(i.visited=!1,i=i===h?null:i.sibling!==null?i.sibling:i.parent):(i.public.isOpen=i===h?_:i.public.isOpen,c(i.public,h.public),i!==h&&v(i),i.visited=i.child!==null,i=i.child!==null?i.child:i===h?null:i.sibling!==null?i.sibling:i.parent);I()}return{order:n,records:a,updateRequest:{}}},mr=function(e){return function(t,n,a){return a.refresh?dr(e,t,n):hr(n,a)}},je=function(r){de(e,r),e.getDerivedStateFromProps=function(a,s){var o=a.listRef,l=o===void 0?null:o,h=a.treeWalker,p=s.computeTree,_=s.list,S=s.order,c=s.treeWalker;return fe({attachRefs:or([_,l])},h!==c||!S?p(a,s,{refresh:!0}):null,{treeWalker:h})};function e(n,a){var s;return s=r.call(this,n,a)||this,s.getRecordData=s.getRecordData.bind(L(s)),s.state={list:C.createRef(),recomputeTree:s.recomputeTree.bind(L(s)),setState:s.setState.bind(L(s))},s}var t=e.prototype;return t.getItemData=function(){var a=this.props,s=a.children,o=a.itemData;return{component:s,getRecordData:this.getRecordData,treeData:o}},t.getRecordData=function(a){var s=this.state,o=s.order,l=s.records;return l.get(o[a]).public},t.recomputeTree=function(a){var s=this;return new Promise(function(o){s.setState(function(l){return l.computeTree(s.props,l,{opennessState:a})},o)})},t.scrollTo=function(a){var s;(s=this.state.list.current)==null||s.scrollTo(a)},t.scrollToItem=function(a,s){var o;(o=this.state.list.current)==null||o.scrollToItem(this.state.order.indexOf(a),s)},e}(C.PureComponent);je.defaultProps={rowComponent:ur};var gr=mr({createRecord:function(e,t,n,a){var s=t.recomputeTree,o=t.resetAfterId,l=lr({data:e,height:a?a.public.height:e.defaultHeight,isOpen:a?a.public.isOpen:e.isOpenByDefault,resize:function(p,_){l.public.height=p,o(l.public.data.id,_)},setOpen:function(p){var _;return s((_={},_[e.id]=p,_))}},n);return l}}),pr=function(r){de(e,r);function e(n,a){var s;return s=r.call(this,n,a)||this,s.getItemSize=s.getItemSize.bind(L(s)),s.state=fe({},s.state,{computeTree:gr,resetAfterId:s.resetAfterId.bind(L(s))}),s}var t=e.prototype;return t.resetAfterId=function(a,s){var o;s===void 0&&(s=!1);var l=this.state,h=l.list,p=l.order;(o=h.current)==null||o.resetAfterIndex(p.indexOf(a),s)},t.recomputeTree=function(a){var s=this;return r.prototype.recomputeTree.call(this,a).then(function(){var o;(o=s.state.list.current)==null||o.resetAfterIndex(0,!0)})},t.render=function(){var a=this.props;a.children;var s=a.placeholder,o=a.itemSize,l=a.rowComponent;a.treeWalker;var h=rt(a,["children","placeholder","itemSize","rowComponent","treeWalker"]),p=this.state,_=p.attachRefs,S=p.order;return s&&S.length===0?s:u.createElement(sr,Object.assign({},h,{itemCount:S.length,itemData:this.getItemData(),itemKey:cr,itemSize:o??this.getItemSize,ref:_}),l)},t.getItemSize=function(a){return this.getRecordData(a).height},e}(je),vr=nt(),_r=O(vr),Sr=it(),br=O(Sr),yr=at(),Ir=O(yr);function le(r){return(r==null?void 0:r.type)==="category"?r.children.map(e=>e.type==="category"?le(e):e.conf).flat(Number.POSITIVE_INFINITY):[]}function Y(r,e=new Map){r.id&&r.children.length&&e.set(r.id,r);for(const t of r.children)Y(t,e);return e}function Tr(r=""){return r.endsWith("(Unsupported)")||r.endsWith("(Unknown)")}const Cr=D()(r=>({contrastColor:{color:r.palette.tertiary.contrastText},accordionText:{margin:"auto 0",width:"100%"}}));function kr({isOpen:r,setOpen:e,data:t}){const{classes:n}=Cr(),[a,s]=C.useState(null),{menuItems:o=[],name:l,model:h,id:p,tree:_}=t;return u.createElement("div",{className:n.accordionText,onClick:()=>{a||(t.toggleCollapse(p),e(!r))}},u.createElement(st,{"data-testid":`htsCategory-${l}`},r?u.createElement(br,null):u.createElement(Ir,null),l,u.createElement(Fe,{onClick:S=>{s(S.currentTarget),S.stopPropagation()},className:n.contrastColor},u.createElement(qe,null))),a?u.createElement(_r,{anchorEl:a,menuItems:[{label:"Add to selection",onClick:()=>{const S=Y(_).get(p);h.addToSelection(le(S))}},{label:"Remove from selection",onClick:()=>{const S=Y(_).get(p);h.removeFromSelection(le(S))}},{label:"Show all tracks",onClick:()=>{var S;for(const c of((S=Y(_).get(p))===null||S===void 0?void 0:S.children)||[])c.type==="track"&&h.view.showTrack(c.trackId)}},{label:"Hide all tracks",onClick:()=>{var S;for(const c of((S=Y(_).get(p))===null||S===void 0?void 0:S.children)||[])c.type==="track"&&h.view.hideTrack(c.trackId)}},...o],onMenuItemClick:(S,c)=>{c(),s(null)},open:!!a,onClose:()=>{s(null)}}):null)}const Er=D()(r=>({compactCheckbox:{padding:0},checkboxLabel:{marginRight:0,"&:hover":{backgroundColor:r.palette.action.selected}},selected:{background:"#cccc"}}));function zr({data:r}){const{classes:e}=Er(),{checked:t,conf:n,model:a,drawerPosition:s,id:o,trackId:l,name:h,onChange:p,selected:_}=r,S=Ae.readConfObject(n,"description");return u.createElement(u.Fragment,null,u.createElement(ue,{title:S+(_?" (in selection)":""),placement:s==="left"?"right":"left"},u.createElement(ot,{className:e.checkboxLabel,control:u.createElement(lt,{className:e.compactCheckbox,checked:t,onChange:()=>{p(l)},disabled:Tr(h),inputProps:{"data-testid":`htsTrackEntry-${o}`}}),label:u.createElement("div",{"data-testid":`htsTrackLabel-${o}`,style:{background:_?"#cccc":void 0}},u.createElement(He,{html:h}))})),u.createElement($e,{model:a,trackId:l,id:o,conf:n}))}const xr=D()(r=>({accordionBase:{display:"flex"},accordionCard:{padding:3,cursor:"pointer",display:"flex"},nestingLevelMarker:{position:"absolute",borderLeft:"1.5px solid #555"},accordionColor:{background:r.palette.tertiary.main,color:r.palette.tertiary.contrastText,width:"100%",display:"flex",paddingLeft:5}}));function Mr({data:r,isOpen:e,style:t,setOpen:n}){const{isLeaf:a,nestingLevel:s}=r,{classes:o}=xr(),l=10,h=s*l+(a?l:0);return u.createElement("div",{style:t,className:a?void 0:o.accordionBase},new Array(s).fill(0).map((p,_)=>u.createElement("div",{key:`mark-${_}`,style:{left:_*l+4,height:t==null?void 0:t.height},className:o.nestingLevelMarker})),u.createElement("div",{className:a?void 0:o.accordionCard,style:{marginLeft:h,whiteSpace:"nowrap",width:"100%"}},u.createElement("div",{className:a?void 0:o.accordionColor},a?u.createElement(zr,{data:r}):u.createElement(kr,{isOpen:e,data:r,setOpen:n}))))}function Le(r,e,t,n){const a=r.type==="track",s=a?n[r.trackId]:!1;return{data:{defaultHeight:a?22:40,isLeaf:a,isOpenByDefault:!0,nestingLevel:e,selected:s,...r,...t},nestingLevel:e,node:r}}const Ne=w(function({height:e,tree:t,model:n}){const{filterText:a,selection:s,view:o}=n,l=C.useRef(null),h=E.getSession(n),{drawerPosition:p}=h,_=C.useMemo(()=>Object.fromEntries(s.map(v=>[v.trackId,v])),[s]),S=C.useMemo(()=>({onChange:v=>{o.toggleTrack(v)&&n.addToRecentlyUsed(v)},toggleCollapse:v=>{n.toggleCategory(v)},tree:t,model:n,drawerPosition:p}),[o,n,p,t]),c=C.useCallback(function*(){for(const I of t.children)yield Le(I,0,S,_);for(;;){const I=yield;for(const i of I.node.children)yield Le(i,I.nestingLevel+1,S,_)}},[t,S,_]);return C.useEffect(()=>{l.current.recomputeTree({refreshNodes:!0,useDefaultHeight:!0})},[t,a]),u.createElement(u.Fragment,null,u.createElement(pr,{ref:l,treeWalker:c,height:e},Mr))}),wr=({tree:r,model:e,offset:t})=>typeof jest>"u"?u.createElement(dt,{disableWidth:!0},n=>u.createElement(Ne,{height:(n.height||t)-t,model:e,tree:r})):u.createElement(Ne,{height:9e3,model:e,tree:r}),Or=({overrideDimensions:r,children:e})=>r?u.createElement("div",{style:{...r}},e):e,Rr=w(function({model:r,toolbarHeight:e,overrideDimensions:t}){return u.createElement(Or,{overrideDimensions:t},u.createElement(Wr,{model:r,toolbarHeight:e}),u.createElement(ht,{model:r}))}),Wr=w(function({model:r,toolbarHeight:e=0}){const[t,n]=C.useState(0);return u.createElement(u.Fragment,null,u.createElement(Kt,{model:r,setHeaderHeight:n}),u.createElement(wr,{tree:r.hierarchy,model:r,offset:e+t}))});var Ar=Object.freeze({__proto__:null,default:Rr});export{Ar as H,Et as S,$e as T};
