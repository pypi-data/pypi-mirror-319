import{b3 as I,b4 as O,b5 as j,f as L,m as T,o as M,a as c,u as F,R as e,c as B,D as P,T as k,aG as z,k as H,d as W,F as J,i as N,C as $,e as V,B as x,Z as X,a3 as Z,X as K,v as Q}from"./index-Bm2SqMk3.js";var p={},G;function U(){if(G)return p;G=1,Object.defineProperty(p,"__esModule",{value:!0}),p.formatFastaLines=r,p.formatSeqFasta=o;function r(a){return a.replaceAll(/(.{1,80})/g,`$1
`).trimEnd()}function o(a){return a.map(n=>`>${n.header}
${r(n.seq)}`).join(`
`)}return p}var Y=U(),d={},_;function ee(){if(_)return d;_=1;var r=I();Object.defineProperty(d,"__esModule",{value:!0}),d.default=void 0;var o=r(O()),a=j();return d.default=(0,o.default)((0,a.jsx)("path",{d:"M19 9h-4V3H9v6H5l7 7zM5 18v2h14v-2z"}),"GetApp"),d}var te=ee();const re=L(te),ae=T()({dialogContent:{width:"80em"},textAreaFont:{fontFamily:"Courier New"},ml:{marginLeft:10}});async function ne(r,o){const a=F.getSession(r),{leftOffset:n,rightOffset:i}=r;if(!n||!i)throw new Error("no offsets on model to use for range");if(n.assemblyName!==i.assemblyName)throw new Error("not able to fetch sequences from multiple assemblies");const{rpcManager:u,assemblyManager:h}=a,l=n.assemblyName||i.assemblyName||"",g=h.get(l);if(!g)throw new Error(`assembly ${l} not found`);const b=Q.getConf(g,["sequence","adapter"]),m="getSequence";return u.call(m,"CoreGetFeatures",{adapterConfig:b,regions:o,sessionId:m})}const oe=M(function({model:r,handleClose:o}){const{classes:a}=ae(),[n,i]=c.useState(),[u,h]=c.useState(),[l,g]=c.useState(!1),[b,m]=c.useState(!1),[v,D]=c.useState(!1),{leftOffset:w,rightOffset:R}=r,E=u===void 0;c.useEffect(()=>{const s=new AbortController;return(async()=>{try{const t=r.getSelectedRegions(w,R);if(t.length===0)throw new Error("Selected region is out of bounds");const C=await ne(r,t);h(C)}catch(t){console.error(t),i(t)}})(),()=>{s.abort()}},[r,w,R]);const f=u?Y.formatSeqFasta(u.map(s=>{let t=s.get("seq");const C=s.get("refName"),S=s.get("start")+1,y=s.get("end"),A=`${C}:${S}-${y}`;if((t==null?void 0:t.length)!==y-S+1)throw new Error(`${A} returned ${t.length.toLocaleString()} bases, but should have returned ${(y-S).toLocaleString()}`);return l&&(t=F.reverse(t)),v&&(t=F.complement(t)),{header:A+(l?"-rev":"")+(v?"-comp":""),seq:t}})):"",q=f?f.length>1e6:!1;return e.createElement(B.Dialog,{maxWidth:"xl",open:!0,onClose:()=>{o(),r.setOffsets()},title:"Reference sequence"},e.createElement(P,null,n?e.createElement(k,{color:"error"},`${n}`):E?e.createElement(z,null,"Retrieving reference sequence...",e.createElement(H,{className:a.ml,size:20,disableShrink:!0})):null,e.createElement(W,{"data-testid":"rubberband-sequence",variant:"outlined",multiline:!0,minRows:5,maxRows:10,disabled:q,className:a.dialogContent,fullWidth:!0,value:q?"Reference sequence too large to display, use the download FASTA button":f,slotProps:{input:{readOnly:!0,classes:{input:a.textAreaFont}}}}),e.createElement(J,null,e.createElement(N,{control:e.createElement($,{value:l,onChange:s=>{g(s.target.checked)}}),label:"Reverse sequence"}),e.createElement(N,{control:e.createElement($,{value:v,onChange:s=>{D(s.target.checked)}}),label:"Complement sequence"})),e.createElement(k,{style:{margin:10}},'Note: Check both boxes for the "reverse complement"')),e.createElement(V,null,e.createElement(x,{onClick:()=>{X(f),m(!0),setTimeout(()=>{m(!1)},500)},disabled:E||!!n||q,color:"primary",startIcon:e.createElement(Z.ContentCopy,null)},b?"Copied":"Copy to clipboard"),e.createElement(x,{onClick:()=>{K.saveAs(new Blob([f||""],{type:"text/x-fasta;charset=utf-8"}),"jbrowse_ref_seq.fa")},disabled:E||!!n,color:"primary",startIcon:e.createElement(re,null)},"Download FASTA"),e.createElement(x,{onClick:o,variant:"contained"},"Close")))});export{oe as default};
