const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/FacetedDialog-BVONdXww.js","assets/index-Bm2SqMk3.js","assets/index-B32Lr0K5.css","assets/SanitizedHTML-CjJss1eo.js","assets/Clear-DseTcK22.js","assets/CloseConnectionDialog-ClveHXXd.js","assets/DeleteConnectionDialog-D2WQ1JXP.js","assets/ManageConnectionsDialog-B8S4Kwhk.js","assets/ToggleConnectionsDialog-BaEqGAgm.js"])))=>i.map(i=>d[i]);
import{a as C,m as L,o as M,u as k,R as d,cn as Je,bk as Xe,co as Ye,M as ve,_ as Y,cp as Z,cq as Ze,v as Ae,b3 as P,b4 as q,b5 as $,f as O,cr as ce,H as Qe,ab as de,d as et,bm as tt,ac as Ne,cs as ue,ct as W,cu as fe,cv as rt,cw as nt,cx as it,cy as at,T as ot,i as st,C as lt}from"./index-Bm2SqMk3.js";import{C as ct}from"./Clear-DseTcK22.js";import{S as Fe}from"./SanitizedHTML-CjJss1eo.js";let x;typeof window<"u"?x=window:typeof self<"u"?x=self:x=global;let oe=null,se=null;const _e=20,te=x.clearTimeout,Se=x.setTimeout,re=x.cancelAnimationFrame||x.mozCancelAnimationFrame||x.webkitCancelAnimationFrame,be=x.requestAnimationFrame||x.mozRequestAnimationFrame||x.webkitRequestAnimationFrame;re==null||be==null?(oe=te,se=function(e){return Se(e,_e)}):(oe=function([e,t]){re(e),te(t)},se=function(e){const t=be(function(){te(n),e()}),n=Se(function(){re(t),e()},_e);return[t,n]});function dt(r){let e,t,n,a,o,s,l;const h=typeof document<"u"&&document.attachEvent;if(!h){s=function(u){const m=u.__resizeTriggers__,g=m.firstElementChild,y=m.lastElementChild,b=g.firstElementChild;y.scrollLeft=y.scrollWidth,y.scrollTop=y.scrollHeight,b.style.width=g.offsetWidth+1+"px",b.style.height=g.offsetHeight+1+"px",g.scrollLeft=g.scrollWidth,g.scrollTop=g.scrollHeight},o=function(u){return u.offsetWidth!==u.__resizeLast__.width||u.offsetHeight!==u.__resizeLast__.height},l=function(u){if(u.target.className&&typeof u.target.className.indexOf=="function"&&u.target.className.indexOf("contract-trigger")<0&&u.target.className.indexOf("expand-trigger")<0)return;const m=this;s(this),this.__resizeRAF__&&oe(this.__resizeRAF__),this.__resizeRAF__=se(function(){o(m)&&(m.__resizeLast__.width=m.offsetWidth,m.__resizeLast__.height=m.offsetHeight,m.__resizeListeners__.forEach(function(b){b.call(m,u)}))})};let c=!1,v="";n="animationstart";const T="Webkit Moz O ms".split(" ");let i="webkitAnimationStart animationstart oAnimationStart MSAnimationStart".split(" "),f="";{const u=document.createElement("fakeelement");if(u.style.animationName!==void 0&&(c=!0),c===!1){for(let m=0;m<T.length;m++)if(u.style[T[m]+"AnimationName"]!==void 0){f=T[m],v="-"+f.toLowerCase()+"-",n=i[m],c=!0;break}}}t="resizeanim",e="@"+v+"keyframes "+t+" { from { opacity: 0; } to { opacity: 0; } } ",a=v+"animation: 1ms "+t+"; "}const p=function(c){if(!c.getElementById("detectElementResize")){const v=(e||"")+".resize-triggers { "+(a||"")+'visibility: hidden; opacity: 0; } .resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; z-index: -1; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',T=c.head||c.getElementsByTagName("head")[0],i=c.createElement("style");i.id="detectElementResize",i.type="text/css",r!=null&&i.setAttribute("nonce",r),i.styleSheet?i.styleSheet.cssText=v:i.appendChild(c.createTextNode(v)),T.appendChild(i)}};return{addResizeListener:function(c,v){if(h)c.attachEvent("onresize",v);else{if(!c.__resizeTriggers__){const T=c.ownerDocument,i=x.getComputedStyle(c);i&&i.position==="static"&&(c.style.position="relative"),p(T),c.__resizeLast__={},c.__resizeListeners__=[],(c.__resizeTriggers__=T.createElement("div")).className="resize-triggers";const f=T.createElement("div");f.className="expand-trigger",f.appendChild(T.createElement("div"));const u=T.createElement("div");u.className="contract-trigger",c.__resizeTriggers__.appendChild(f),c.__resizeTriggers__.appendChild(u),c.appendChild(c.__resizeTriggers__),s(c),c.addEventListener("scroll",l,!0),n&&(c.__resizeTriggers__.__animationListener__=function(g){g.animationName===t&&s(c)},c.__resizeTriggers__.addEventListener(n,c.__resizeTriggers__.__animationListener__))}c.__resizeListeners__.push(v)}},removeResizeListener:function(c,v){if(h)c.detachEvent("onresize",v);else if(c.__resizeListeners__.splice(c.__resizeListeners__.indexOf(v),1),!c.__resizeListeners__.length){c.removeEventListener("scroll",l,!0),c.__resizeTriggers__.__animationListener__&&(c.__resizeTriggers__.removeEventListener(n,c.__resizeTriggers__.__animationListener__),c.__resizeTriggers__.__animationListener__=null);try{c.__resizeTriggers__=!c.removeChild(c.__resizeTriggers__)}catch{}}}}}class ut extends C.Component{constructor(...e){super(...e),this.state={height:this.props.defaultHeight||0,scaledHeight:this.props.defaultHeight||0,scaledWidth:this.props.defaultWidth||0,width:this.props.defaultWidth||0},this._autoSizer=null,this._detectElementResize=null,this._parentNode=null,this._resizeObserver=null,this._timeoutId=null,this._onResize=()=>{this._timeoutId=null;const{disableHeight:t,disableWidth:n,onResize:a}=this.props;if(this._parentNode){const o=window.getComputedStyle(this._parentNode)||{},s=parseFloat(o.paddingLeft||"0"),l=parseFloat(o.paddingRight||"0"),h=parseFloat(o.paddingTop||"0"),p=parseFloat(o.paddingBottom||"0"),_=this._parentNode.getBoundingClientRect(),S=_.height-h-p,c=_.width-s-l,v=this._parentNode.offsetHeight-h-p,T=this._parentNode.offsetWidth-s-l;(!t&&(this.state.height!==v||this.state.scaledHeight!==S)||!n&&(this.state.width!==T||this.state.scaledWidth!==c))&&(this.setState({height:v,width:T,scaledHeight:S,scaledWidth:c}),typeof a=="function"&&a({height:v,scaledHeight:S,scaledWidth:c,width:T}))}},this._setRef=t=>{this._autoSizer=t}}componentDidMount(){const{nonce:e}=this.props,t=this._autoSizer?this._autoSizer.parentNode:null;if(t!=null&&t.ownerDocument&&t.ownerDocument.defaultView&&t instanceof t.ownerDocument.defaultView.HTMLElement){this._parentNode=t;const n=t.ownerDocument.defaultView.ResizeObserver;n!=null?(this._resizeObserver=new n(()=>{this._timeoutId=setTimeout(this._onResize,0)}),this._resizeObserver.observe(t)):(this._detectElementResize=dt(e),this._detectElementResize.addResizeListener(t,this._onResize)),this._onResize()}}componentWillUnmount(){this._parentNode&&(this._detectElementResize&&this._detectElementResize.removeResizeListener(this._parentNode,this._onResize),this._timeoutId!==null&&clearTimeout(this._timeoutId),this._resizeObserver&&this._resizeObserver.disconnect())}render(){const{children:e,defaultHeight:t,defaultWidth:n,disableHeight:a=!1,disableWidth:o=!1,doNotBailOutOnEmptyChildren:s=!1,nonce:l,onResize:h,style:p={},tagName:_="div",...S}=this.props,{height:c,scaledHeight:v,scaledWidth:T,width:i}=this.state,f={overflow:"visible"},u={};let m=!1;return a||(c===0&&(m=!0),f.height=0,u.height=c,u.scaledHeight=v),o||(i===0&&(m=!0),f.width=0,u.width=i,u.scaledWidth=T),s&&(m=!1),C.createElement(_,{ref:this._setRef,style:{...f,...p},...S},!m&&e(u))}}const ft=L()(r=>({fab:{position:"absolute",bottom:r.spacing(6),right:r.spacing(6)}})),ht=M(function({model:r}){const{classes:e}=ft(),t=k.getSession(r),[n,a]=C.useState(null);function o(){a(null)}const s=k.isSessionModelWithConnections(t),l=k.isSessionWithAddTracks(t);return l||s?d.createElement(d.Fragment,null,d.createElement(Je,{color:"secondary",className:e.fab,onClick:h=>{a(h.currentTarget)}},d.createElement(Xe,null)),d.createElement(Ye,{anchorEl:n,open:!!n,onClose:()=>{a(null)}},s?d.createElement(ve,{onClick:()=>{o(),k.isSessionModelWithWidgets(t)&&t.showWidget(t.addWidget("AddConnectionWidget","addConnectionWidget"))}},"Add connection"):null,l?d.createElement(ve,{onClick:()=>{o(),k.isSessionModelWithWidgets(t)&&t.showWidget(t.addWidget("AddTrackWidget","addTrackWidget",{view:r.view.id}))}},"Add track"):null)):null}),mt=C.lazy(()=>Y(()=>import("./FacetedDialog-BVONdXww.js"),__vite__mapDeps([0,1,2,3,4]))),gt=C.lazy(()=>Y(()=>import("./CloseConnectionDialog-ClveHXXd.js"),__vite__mapDeps([5,1,2]))),pt=C.lazy(()=>Y(()=>import("./DeleteConnectionDialog-D2WQ1JXP.js"),__vite__mapDeps([6,1,2]))),vt=C.lazy(()=>Y(()=>import("./ManageConnectionsDialog-B8S4Kwhk.js"),__vite__mapDeps([7,1,2]))),_t=C.lazy(()=>Y(()=>import("./ToggleConnectionsDialog-BaEqGAgm.js"),__vite__mapDeps([8,1,2]))),St=M(function({model:r}){const e=k.getSession(r),[t,n]=C.useState(),[a,o]=C.useState(),[s,l]=C.useState(!1),[h,p]=C.useState(!1),[_,S]=C.useState(!1);function c(v,T){var i;const f=Ae.readConfObject(v,"name"),u=(i=e.prepareToBreakConnection)===null||i===void 0?void 0:i.call(e,v);if(u){const[m,g]=u;Object.keys(g).length>0?n({connectionConf:v,safelyBreakConnection:m,dereferenceTypeCount:g,name:f}):m()}T&&o({name:f,connectionConf:v})}return d.createElement(d.Fragment,null,d.createElement(Z,{menuItems:[{label:"Open faceted track selector",onClick:()=>{S(!0)}},...k.isSessionWithAddTracks(e)?[{label:"Add track...",onClick:()=>{k.isSessionModelWithWidgets(e)&&e.showWidget(e.addWidget("AddTrackWidget","addTrackWidget",{view:r.view.id}))}}]:[],{label:"Connections...",subMenu:[...k.isSessionModelWithConnections(e)?[{label:"Turn on/off connections...",onClick:()=>{l(!0)}}]:[],...k.isSessionModelWithConnectionEditing(e)?[{label:"Add connection...",onClick:()=>{k.isSessionModelWithWidgets(e)&&e.showWidget(e.addWidget("AddConnectionWidget","addConnectionWidget"))}},{label:"Delete connections...",onClick:()=>{p(!0)}}]:[]]},{label:"Sort...",type:"subMenu",subMenu:[{label:"Sort tracks by name",type:"checkbox",checked:r.activeSortTrackNames,onClick:()=>{r.setSortTrackNames(!r.activeSortTrackNames)}},{label:"Sort categories by name",type:"checkbox",checked:r.activeSortCategories,onClick:()=>{r.setSortCategories(!r.activeSortCategories)}}]},{label:"Collapse...",type:"subMenu",subMenu:[...r.hasAnySubcategories?[{label:"Collapse subcategories",onClick:()=>{r.collapseSubCategories()}}]:[],{label:"Collapse top-level categories",onClick:()=>{r.collapseTopLevelCategories()}},{label:"Expand all categories",onClick:()=>{r.expandAllCategories()}}]}]},d.createElement(Ze,null)),d.createElement(C.Suspense,{fallback:null},t?d.createElement(gt,{modalInfo:t,onClose:()=>{n(void 0)}}):null,a?d.createElement(pt,{handleClose:()=>{o(void 0)},deleteDialogDetails:a,session:e}):null,h?d.createElement(vt,{handleClose:()=>{p(!1)},breakConnection:c,session:e}):null,s?d.createElement(_t,{handleClose:()=>{l(!1)},session:e,breakConnection:c}):null,_?d.createElement(mt,{handleClose:()=>{S(!1)},model:r}):null))});var j={},ye;function bt(){if(ye)return j;ye=1;var r=P();Object.defineProperty(j,"__esModule",{value:!0}),j.default=void 0;var e=r(q()),t=$();return j.default=(0,e.default)((0,t.jsx)("path",{d:"M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2M1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2"}),"ShoppingCart"),j}var yt=bt();const Tt=O(yt),It=M(function({model:r}){const{selection:e}=r,{pluginManager:t}=k.getEnv(r),n=k.getSession(r),a=t.evaluateExtensionPoint("TrackSelector-multiTrackMenuItems",[],{session:n});return e.length?d.createElement(Z,{menuItems:[{label:"Clear",onClick:()=>{r.clearSelection()}},...a.map(o=>({...o,..."onClick"in o?{onClick:()=>{o.onClick(r)}}:{}}))]},d.createElement(ce,{badgeContent:e.length,color:"primary"},d.createElement(Tt,null))):null});var U={},Te;function Ct(){if(Te)return U;Te=1;var r=P();Object.defineProperty(U,"__esModule",{value:!0}),U.default=void 0;var e=r(q()),t=$();return U.default=(0,e.default)((0,t.jsx)("path",{d:"M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"}),"Grade"),U}var Et=Ct();const kt=O(Et);var V={},Ie;function zt(){if(Ie)return V;Ie=1;var r=P();Object.defineProperty(V,"__esModule",{value:!0}),V.default=void 0;var e=r(q()),t=$();return V.default=(0,e.default)((0,t.jsx)("path",{d:"M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreHoriz"),V}var xt=zt();const He=O(xt);var G={},Ce;function wt(){if(Ce)return G;Ce=1;var r=P();Object.defineProperty(G,"__esModule",{value:!0}),G.default=void 0;var e=r(q()),t=$();return G.default=(0,e.default)((0,t.jsx)("path",{d:"M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"}),"Star"),G}var Mt=wt();const Ot=O(Mt);var K={},Ee;function Rt(){if(Ee)return K;Ee=1;var r=P();Object.defineProperty(K,"__esModule",{value:!0}),K.default=void 0;var e=r(q()),t=$();return K.default=(0,e.default)((0,t.jsx)("path",{d:"m22 9.24-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28z"}),"StarBorderOutlined"),K}var Dt=Rt();const Lt=O(Dt),Wt=L()({cascadingStyle:{padding:0}}),Pe=function({id:r,trackId:e,stopPropagation:t,model:n,setOpen:a,conf:o}){var s,l;const{classes:h}=Wt();return d.createElement(Z,{className:h.cascadingStyle,stopPropagation:t,setOpen:a,"data-testid":`htsTrackEntryMenu-${r}`,menuItems:[...((l=(s=k.getSession(n)).getTrackActionMenuItems)===null||l===void 0?void 0:l.call(s,o))||[],n.isFavorite(e)?{label:"Remove from favorites",onClick:()=>{n.removeFromFavorites(e)},icon:Lt}:{label:"Add to favorites",onClick:()=>{n.addToFavorites(e)},icon:Ot},{label:"Add to selection",onClick:()=>{n.addToSelection([o])}},...n.isSelected(o)?[{label:"Remove from selection",onClick:()=>{n.removeFromSelection([o])}}]:[]]},d.createElement(He,null))},qe=M(function({model:r,tracks:e,extraMenuItems:t,children:n,onClick:a}){const{view:o}=r,[s,l]=C.useState(!1),h=k.getSession(r);return o?d.createElement(Z,{closeAfterItemClick:!1,onClick:a,menuItems:[...e.map(p=>({type:"checkbox",label:d.createElement(d.Fragment,null,d.createElement(Fe,{html:Qe.getTrackName(p,h)})," ",d.createElement(Pe,{id:p.trackId,trackId:p.trackId,model:r,conf:p,setOpen:l,stopPropagation:!0})),checked:o.tracks.some(_=>_.configuration===p),onClick:()=>{s||r.view.toggleTrack(p.trackId)&&r.addToRecentlyUsed(p.trackId)}})),...t]},n):null}),At=L()({smallBadge:{height:14},margin:{marginRight:10}}),Nt=M(function({model:r}){const{classes:e}=At(),{view:t,favoriteTracks:n}=r;return t?d.createElement(qe,{onClick:()=>{r.setFavoritesCounter(0)},tracks:n,model:r,extraMenuItems:n.length?[{type:"divider"},{label:"Clear favorites",onClick:()=>{r.clearFavorites()}}]:[{label:"No favorite tracks yet",onClick:()=>{}}]},d.createElement(de,{title:"Favorite tracks"},d.createElement(ce,{classes:{badge:e.smallBadge},color:"secondary",anchorOrigin:{vertical:"bottom",horizontal:"right"},className:e.margin,badgeContent:r.favoritesCounter},d.createElement(kt,null)))):null});var J={},ke;function Ft(){if(ke)return J;ke=1;var r=P();Object.defineProperty(J,"__esModule",{value:!0}),J.default=void 0;var e=r(q()),t=$();return J.default=(0,e.default)((0,t.jsx)("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9m-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8z"}),"History"),J}var Ht=Ft();const Pt=O(Ht),qt=L()({smallBadge:{height:14}}),$t=M(function({model:r}){const{classes:e}=qt(),{view:t,recentlyUsedCounter:n,recentlyUsedTracks:a}=r;return t?d.createElement(qe,{onClick:()=>{r.setRecentlyUsedCounter(0)},model:r,tracks:a,extraMenuItems:a.length?[{type:"divider"},{label:"Clear recently used",onClick:()=>{r.clearRecentlyUsed()}}]:[{label:"No recently used",onClick:()=>{}}]},d.createElement(de,{title:"Recently used tracks"},d.createElement(ce,{classes:{badge:e.smallBadge},anchorOrigin:{vertical:"bottom",horizontal:"right"},color:"secondary",badgeContent:n},d.createElement(Pt,null)))):null}),Bt=L()(r=>({searchBox:{margin:r.spacing(2)}})),jt=M(function({model:r}){const{filterText:e}=r,{classes:t}=Bt();return d.createElement(et,{className:t.searchBox,label:"Filter tracks",value:e,onChange:n=>{r.setFilterText(n.target.value)},fullWidth:!0,slotProps:{input:{endAdornment:d.createElement(tt,{position:"end"},d.createElement(Ne,{onClick:()=>{r.clearFilterText()}},d.createElement(ct,null)))}}})}),Ut=M(function({model:r,setHeaderHeight:e}){return d.createElement("div",{ref:t=>{e((t==null?void 0:t.getBoundingClientRect().height)||0)},"data-testid":"hierarchical_track_selector"},d.createElement("div",{style:{display:"flex"}},d.createElement(St,{model:r}),d.createElement(It,{model:r}),d.createElement(jt,{model:r}),d.createElement($t,{model:r}),d.createElement(Nt,{model:r})))});var ze=Number.isNaN||function(e){return typeof e=="number"&&e!==e};function Vt(r,e){return!!(r===e||ze(r)&&ze(e))}function Gt(r,e){if(r.length!==e.length)return!1;for(var t=0;t<r.length;t++)if(!Vt(r[t],e[t]))return!1;return!0}function ne(r,e){e===void 0&&(e=Gt);var t,n=[],a,o=!1;function s(){for(var l=[],h=0;h<arguments.length;h++)l[h]=arguments[h];return o&&t===this&&e(l,n)||(a=r.apply(this,l),o=!0,t=this,n=l),a}return s}var Kt=typeof performance=="object"&&typeof performance.now=="function",xe=Kt?function(){return performance.now()}:function(){return Date.now()};function we(r){cancelAnimationFrame(r.id)}function Jt(r,e){var t=xe();function n(){xe()-t>=e?r.call(null):a.id=requestAnimationFrame(n)}var a={id:requestAnimationFrame(n)};return a}var ie=-1;function Me(r){if(r===void 0&&(r=!1),ie===-1||r){var e=document.createElement("div"),t=e.style;t.width="50px",t.height="50px",t.overflow="scroll",document.body.appendChild(e),ie=e.offsetWidth-e.clientWidth,document.body.removeChild(e)}return ie}var F=null;function Oe(r){if(r===void 0&&(r=!1),F===null||r){var e=document.createElement("div"),t=e.style;t.width="50px",t.height="50px",t.overflow="scroll",t.direction="rtl";var n=document.createElement("div"),a=n.style;return a.width="100px",a.height="100px",e.appendChild(n),document.body.appendChild(e),e.scrollLeft>0?F="positive-descending":(e.scrollLeft=1,e.scrollLeft===0?F="negative":F="positive-ascending"),document.body.removeChild(e),F}return F}var Xt=150,Yt=function(e,t){return e};function Zt(r){var e,t=r.getItemOffset,n=r.getEstimatedTotalSize,a=r.getItemSize,o=r.getOffsetForIndexAndAlignment,s=r.getStartIndexForOffset,l=r.getStopIndexForStartIndex,h=r.initInstanceProps,p=r.shouldResetStyleCacheOnItemSizeChange,_=r.validateProps;return e=function(S){ue(c,S);function c(T){var i;return i=S.call(this,T)||this,i._instanceProps=h(i.props,W(i)),i._outerRef=void 0,i._resetIsScrollingTimeoutId=null,i.state={instance:W(i),isScrolling:!1,scrollDirection:"forward",scrollOffset:typeof i.props.initialScrollOffset=="number"?i.props.initialScrollOffset:0,scrollUpdateWasRequested:!1},i._callOnItemsRendered=void 0,i._callOnItemsRendered=ne(function(f,u,m,g){return i.props.onItemsRendered({overscanStartIndex:f,overscanStopIndex:u,visibleStartIndex:m,visibleStopIndex:g})}),i._callOnScroll=void 0,i._callOnScroll=ne(function(f,u,m){return i.props.onScroll({scrollDirection:f,scrollOffset:u,scrollUpdateWasRequested:m})}),i._getItemStyle=void 0,i._getItemStyle=function(f){var u=i.props,m=u.direction,g=u.itemSize,y=u.layout,b=i._getItemStyleCache(p&&g,p&&y,p&&m),I;if(b.hasOwnProperty(f))I=b[f];else{var E=t(i.props,f,i._instanceProps),w=a(i.props,f,i._instanceProps),z=m==="horizontal"||y==="horizontal",R=m==="rtl",A=z?E:0;b[f]=I={position:"absolute",left:R?void 0:A,right:R?A:void 0,top:z?0:E,height:z?"100%":w,width:z?w:"100%"}}return I},i._getItemStyleCache=void 0,i._getItemStyleCache=ne(function(f,u,m){return{}}),i._onScrollHorizontal=function(f){var u=f.currentTarget,m=u.clientWidth,g=u.scrollLeft,y=u.scrollWidth;i.setState(function(b){if(b.scrollOffset===g)return null;var I=i.props.direction,E=g;if(I==="rtl")switch(Oe()){case"negative":E=-g;break;case"positive-descending":E=y-m-g;break}return E=Math.max(0,Math.min(E,y-m)),{isScrolling:!0,scrollDirection:b.scrollOffset<E?"forward":"backward",scrollOffset:E,scrollUpdateWasRequested:!1}},i._resetIsScrollingDebounced)},i._onScrollVertical=function(f){var u=f.currentTarget,m=u.clientHeight,g=u.scrollHeight,y=u.scrollTop;i.setState(function(b){if(b.scrollOffset===y)return null;var I=Math.max(0,Math.min(y,g-m));return{isScrolling:!0,scrollDirection:b.scrollOffset<I?"forward":"backward",scrollOffset:I,scrollUpdateWasRequested:!1}},i._resetIsScrollingDebounced)},i._outerRefSetter=function(f){var u=i.props.outerRef;i._outerRef=f,typeof u=="function"?u(f):u!=null&&typeof u=="object"&&u.hasOwnProperty("current")&&(u.current=f)},i._resetIsScrollingDebounced=function(){i._resetIsScrollingTimeoutId!==null&&we(i._resetIsScrollingTimeoutId),i._resetIsScrollingTimeoutId=Jt(i._resetIsScrolling,Xt)},i._resetIsScrolling=function(){i._resetIsScrollingTimeoutId=null,i.setState({isScrolling:!1},function(){i._getItemStyleCache(-1,null)})},i}c.getDerivedStateFromProps=function(i,f){return Qt(i,f),_(i),null};var v=c.prototype;return v.scrollTo=function(i){i=Math.max(0,i),this.setState(function(f){return f.scrollOffset===i?null:{scrollDirection:f.scrollOffset<i?"forward":"backward",scrollOffset:i,scrollUpdateWasRequested:!0}},this._resetIsScrollingDebounced)},v.scrollToItem=function(i,f){f===void 0&&(f="auto");var u=this.props,m=u.itemCount,g=u.layout,y=this.state.scrollOffset;i=Math.max(0,Math.min(i,m-1));var b=0;if(this._outerRef){var I=this._outerRef;g==="vertical"?b=I.scrollWidth>I.clientWidth?Me():0:b=I.scrollHeight>I.clientHeight?Me():0}this.scrollTo(o(this.props,i,f,y,this._instanceProps,b))},v.componentDidMount=function(){var i=this.props,f=i.direction,u=i.initialScrollOffset,m=i.layout;if(typeof u=="number"&&this._outerRef!=null){var g=this._outerRef;f==="horizontal"||m==="horizontal"?g.scrollLeft=u:g.scrollTop=u}this._callPropsCallbacks()},v.componentDidUpdate=function(){var i=this.props,f=i.direction,u=i.layout,m=this.state,g=m.scrollOffset,y=m.scrollUpdateWasRequested;if(y&&this._outerRef!=null){var b=this._outerRef;if(f==="horizontal"||u==="horizontal")if(f==="rtl")switch(Oe()){case"negative":b.scrollLeft=-g;break;case"positive-ascending":b.scrollLeft=g;break;default:var I=b.clientWidth,E=b.scrollWidth;b.scrollLeft=E-I-g;break}else b.scrollLeft=g;else b.scrollTop=g}this._callPropsCallbacks()},v.componentWillUnmount=function(){this._resetIsScrollingTimeoutId!==null&&we(this._resetIsScrollingTimeoutId)},v.render=function(){var i=this.props,f=i.children,u=i.className,m=i.direction,g=i.height,y=i.innerRef,b=i.innerElementType,I=i.innerTagName,E=i.itemCount,w=i.itemData,z=i.itemKey,R=z===void 0?Yt:z,A=i.layout,Q=i.outerElementType,N=i.outerTagName,D=i.style,je=i.useIsScrolling,Ue=i.width,he=this.state.isScrolling,ee=m==="horizontal"||A==="horizontal",Ve=ee?this._onScrollHorizontal:this._onScrollVertical,me=this._getRangeToRender(),Ge=me[0],Ke=me[1],ge=[];if(E>0)for(var B=Ge;B<=Ke;B++)ge.push(C.createElement(f,{data:w,key:R(B,w),index:B,isScrolling:je?he:void 0,style:this._getItemStyle(B)}));var pe=n(this.props,this._instanceProps);return C.createElement(Q||N||"div",{className:u,onScroll:Ve,ref:this._outerRefSetter,style:fe({position:"relative",height:g,width:Ue,overflow:"auto",WebkitOverflowScrolling:"touch",willChange:"transform",direction:m},D)},C.createElement(b||I||"div",{children:ge,ref:y,style:{height:ee?"100%":pe,pointerEvents:he?"none":void 0,width:ee?pe:"100%"}}))},v._callPropsCallbacks=function(){if(typeof this.props.onItemsRendered=="function"){var i=this.props.itemCount;if(i>0){var f=this._getRangeToRender(),u=f[0],m=f[1],g=f[2],y=f[3];this._callOnItemsRendered(u,m,g,y)}}if(typeof this.props.onScroll=="function"){var b=this.state,I=b.scrollDirection,E=b.scrollOffset,w=b.scrollUpdateWasRequested;this._callOnScroll(I,E,w)}},v._getRangeToRender=function(){var i=this.props,f=i.itemCount,u=i.overscanCount,m=this.state,g=m.isScrolling,y=m.scrollDirection,b=m.scrollOffset;if(f===0)return[0,0,0,0];var I=s(this.props,b,this._instanceProps),E=l(this.props,I,b,this._instanceProps),w=!g||y==="backward"?Math.max(1,u):1,z=!g||y==="forward"?Math.max(1,u):1;return[Math.max(0,I-w),Math.max(0,Math.min(f-1,E+z)),I,E]},c}(C.PureComponent),e.defaultProps={direction:"ltr",itemData:void 0,layout:"vertical",overscanCount:2,useIsScrolling:!1},e}var Qt=function(e,t){e.children,e.direction,e.height,e.layout,e.innerTagName,e.outerTagName,e.width,t.instance},er=50,H=function(e,t,n){var a=e,o=a.itemSize,s=n.itemMetadataMap,l=n.lastMeasuredIndex;if(t>l){var h=0;if(l>=0){var p=s[l];h=p.offset+p.size}for(var _=l+1;_<=t;_++){var S=o(_);s[_]={offset:h,size:S},h+=S}n.lastMeasuredIndex=t}return s[t]},tr=function(e,t,n){var a=t.itemMetadataMap,o=t.lastMeasuredIndex,s=o>0?a[o].offset:0;return s>=n?$e(e,t,o,0,n):rr(e,t,Math.max(0,o),n)},$e=function(e,t,n,a,o){for(;a<=n;){var s=a+Math.floor((n-a)/2),l=H(e,s,t).offset;if(l===o)return s;l<o?a=s+1:l>o&&(n=s-1)}return a>0?a-1:0},rr=function(e,t,n,a){for(var o=e.itemCount,s=1;n<o&&H(e,n,t).offset<a;)n+=s,s*=2;return $e(e,t,Math.min(n,o-1),Math.floor(n/2),a)},Re=function(e,t){var n=e.itemCount,a=t.itemMetadataMap,o=t.estimatedItemSize,s=t.lastMeasuredIndex,l=0;if(s>=n&&(s=n-1),s>=0){var h=a[s];l=h.offset+h.size}var p=n-s-1,_=p*o;return l+_},nr=Zt({getItemOffset:function(e,t,n){return H(e,t,n).offset},getItemSize:function(e,t,n){return n.itemMetadataMap[t].size},getEstimatedTotalSize:Re,getOffsetForIndexAndAlignment:function(e,t,n,a,o,s){var l=e.direction,h=e.height,p=e.layout,_=e.width,S=l==="horizontal"||p==="horizontal",c=S?_:h,v=H(e,t,o),T=Re(e,o),i=Math.max(0,Math.min(T-c,v.offset)),f=Math.max(0,v.offset-c+v.size+s);switch(n==="smart"&&(a>=f-c&&a<=i+c?n="auto":n="center"),n){case"start":return i;case"end":return f;case"center":return Math.round(f+(i-f)/2);case"auto":default:return a>=f&&a<=i?a:a<f?f:i}},getStartIndexForOffset:function(e,t,n){return tr(e,n,t)},getStopIndexForStartIndex:function(e,t,n,a){for(var o=e.direction,s=e.height,l=e.itemCount,h=e.layout,p=e.width,_=o==="horizontal"||h==="horizontal",S=_?p:s,c=H(e,t,a),v=n+S,T=c.offset+c.size,i=t;i<l-1&&T<v;)i++,T+=H(e,i,a).size;return i},initInstanceProps:function(e,t){var n=e,a=n.estimatedItemSize,o={itemMetadataMap:{},estimatedItemSize:a||er,lastMeasuredIndex:-1};return t.resetAfterIndex=function(s,l){l===void 0&&(l=!0),o.lastMeasuredIndex=Math.min(o.lastMeasuredIndex,s-1),t._getItemStyleCache(-1),l&&t.forceUpdate()},o},shouldResetStyleCacheOnItemSizeChange:!1,validateProps:function(e){e.itemSize}});function ir(r){return function(e){r.forEach(function(t){typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var ae=function(){},ar=function(e,t){return t===void 0&&(t=null),{child:null,isShown:t?t.public.isOpen&&t.isShown:!0,parent:t,public:e,sibling:null,visited:!1}},or=function(e,t){var n=t.getRecordData,a=n(e),o=a.data.id;return o},sr=function(e){var t=e.index,n=e.data,a=n.component,o=n.getRecordData,s=n.treeData,l=e.style,h=e.isScrolling,p=o(t);return d.createElement(a,Object.assign({isScrolling:h,style:l,treeData:s},p))},lr=function(e,t,n){var a=e.createRecord,o=t.buildingTaskTimeout,s=t.placeholder,l=t.async,h=l===void 0?!1:l,p=t.treeWalker,_=h&&n.records!==void 0,S=n.records,c=[],v=new Map,T=o?{timeout:o}:void 0,i=new WeakMap,f=p(),u=f.next(),m=u.value,g=a(m.data,n,void 0,_?S.get(m.data.id):void 0);v.set(g.public.data.id,g),i.set(g,m);var y=g,b=!0,I=g,E=s!==void 0&&!(s===null&&!n.order),w=E?function(R){return R.timeRemaining()>0}:function(){return!0},z=function R(A){for(;y!==null;){if(!w(A)){requestIdleCallback(R,T);return}if(y.visited)y.visited=!1,y=y.sibling!==null?y.sibling:y.parent,I=y;else{var Q=f.next(i.get(y)),N=Q.value;if(N===void 0){b?b=!1:(y.isShown&&c.push(y.public.data.id),y.visited=y.child!==null,y=y.child!==null?y.child:y.sibling!==null?y.sibling:y.parent),I=y;continue}var D=a(N.data,n,b?void 0:y,_?S.get(N.data.id):void 0);v.set(D.public.data.id,D),i.set(D,N),!b&&I===y?I.child=D:I.sibling=D,I=D}}E&&n.setState({order:c,records:v,updateRequest:{}})};return E?requestIdleCallback(z,T):z(),s!==void 0&&h&&n.order?n:{order:c,records:v}},De=32768,cr=2,dr=function(e,t){var n=e.order,a=e.records,o=t.opennessState;if(typeof o!="object")return null;for(var s in o)if(a.has(s)){var l=o[s],h=a.get(s),p=typeof l=="boolean"?{open:l}:l,_=p.open,S=p.subtreeCallback,c=S===void 0?ae:S,v=ae,T=ae;h.isShown&&(_?function(){for(var f=n.indexOf(s),u=h;u!==null;){if(u.sibling!==null){u=u.sibling;break}u=u.parent}var m=u===null?n.length-1-f:n.indexOf(u.public.data.id)-1-f,g=[[f+1,m]];v=function(b){if(b.isShown=b.parent?b.parent.public.isOpen&&b.parent.isShown:!0,b.isShown){var I=g[g.length-1];I.push(b.public.data.id),I.length===De+cr&&g.push([f+1+De*g.length,0])}},T=function(){for(var b=0;b<g.length;b++){var I;(I=n).splice.apply(I,g[b])}}}():h.public.isOpen&&function(){var f=n.indexOf(s),u=0;v=function(g){g.isShown&&(u+=1),g.isShown=g.parent?g.parent.public.isOpen&&g.parent.isShown:!0},T=function(){n.splice(f+1,u)}}());for(var i=h;i!==null;)i.visited?(i.visited=!1,i=i===h?null:i.sibling!==null?i.sibling:i.parent):(i.public.isOpen=i===h?_:i.public.isOpen,c(i.public,h.public),i!==h&&v(i),i.visited=i.child!==null,i=i.child!==null?i.child:i===h?null:i.sibling!==null?i.sibling:i.parent);T()}return{order:n,records:a,updateRequest:{}}},ur=function(e){return function(t,n,a){return a.refresh?lr(e,t,n):dr(n,a)}},Be=function(r){ue(e,r),e.getDerivedStateFromProps=function(a,o){var s=a.listRef,l=s===void 0?null:s,h=a.treeWalker,p=o.computeTree,_=o.list,S=o.order,c=o.treeWalker;return fe({attachRefs:ir([_,l])},h!==c||!S?p(a,o,{refresh:!0}):null,{treeWalker:h})};function e(n,a){var o;return o=r.call(this,n,a)||this,o.getRecordData=o.getRecordData.bind(W(o)),o.state={list:C.createRef(),recomputeTree:o.recomputeTree.bind(W(o)),setState:o.setState.bind(W(o))},o}var t=e.prototype;return t.getItemData=function(){var a=this.props,o=a.children,s=a.itemData;return{component:o,getRecordData:this.getRecordData,treeData:s}},t.getRecordData=function(a){var o=this.state,s=o.order,l=o.records;return l.get(s[a]).public},t.recomputeTree=function(a){var o=this;return new Promise(function(s){o.setState(function(l){return l.computeTree(o.props,l,{opennessState:a})},s)})},t.scrollTo=function(a){var o;(o=this.state.list.current)==null||o.scrollTo(a)},t.scrollToItem=function(a,o){var s;(s=this.state.list.current)==null||s.scrollToItem(this.state.order.indexOf(a),o)},e}(C.PureComponent);Be.defaultProps={rowComponent:sr};var fr=ur({createRecord:function(e,t,n,a){var o=t.recomputeTree,s=t.resetAfterId,l=ar({data:e,height:a?a.public.height:e.defaultHeight,isOpen:a?a.public.isOpen:e.isOpenByDefault,resize:function(p,_){l.public.height=p,s(l.public.data.id,_)},setOpen:function(p){var _;return o((_={},_[e.id]=p,_))}},n);return l}}),hr=function(r){ue(e,r);function e(n,a){var o;return o=r.call(this,n,a)||this,o.getItemSize=o.getItemSize.bind(W(o)),o.state=fe({},o.state,{computeTree:fr,resetAfterId:o.resetAfterId.bind(W(o))}),o}var t=e.prototype;return t.resetAfterId=function(a,o){var s;o===void 0&&(o=!1);var l=this.state,h=l.list,p=l.order;(s=h.current)==null||s.resetAfterIndex(p.indexOf(a),o)},t.recomputeTree=function(a){var o=this;return r.prototype.recomputeTree.call(this,a).then(function(){var s;(s=o.state.list.current)==null||s.resetAfterIndex(0,!0)})},t.render=function(){var a=this.props;a.children;var o=a.placeholder,s=a.itemSize,l=a.rowComponent;a.treeWalker;var h=rt(a,["children","placeholder","itemSize","rowComponent","treeWalker"]),p=this.state,_=p.attachRefs,S=p.order;return o&&S.length===0?o:d.createElement(nr,Object.assign({},h,{itemCount:S.length,itemData:this.getItemData(),itemKey:or,itemSize:s??this.getItemSize,ref:_}),l)},t.getItemSize=function(a){return this.getRecordData(a).height},e}(Be),mr=nt();const gr=O(mr);var pr=it();const vr=O(pr);var _r=at();const Sr=O(_r);function le(r){return(r==null?void 0:r.type)==="category"?r.children.map(e=>e.type==="category"?le(e):e.conf).flat(Number.POSITIVE_INFINITY):[]}function X(r,e=new Map){r.id&&r.children.length&&e.set(r.id,r);for(const t of r.children)X(t,e);return e}function br(r=""){return r.endsWith("(Unsupported)")||r.endsWith("(Unknown)")}const yr=L()(r=>({contrastColor:{color:r.palette.tertiary.contrastText},accordionText:{margin:"auto 0",width:"100%"}}));function Tr({isOpen:r,setOpen:e,data:t}){const{classes:n}=yr(),[a,o]=C.useState(null),{menuItems:s=[],name:l,model:h,id:p,tree:_}=t;return d.createElement("div",{className:n.accordionText,onClick:()=>{a||(t.toggleCollapse(p),e(!r))}},d.createElement(ot,{"data-testid":`htsCategory-${l}`},r?d.createElement(vr,null):d.createElement(Sr,null),l,d.createElement(Ne,{onClick:S=>{o(S.currentTarget),S.stopPropagation()},className:n.contrastColor},d.createElement(He,null))),a?d.createElement(gr,{anchorEl:a,menuItems:[{label:"Add to selection",onClick:()=>{const S=X(_).get(p);h.addToSelection(le(S))}},{label:"Remove from selection",onClick:()=>{const S=X(_).get(p);h.removeFromSelection(le(S))}},{label:"Show all tracks",onClick:()=>{var S;for(const c of((S=X(_).get(p))===null||S===void 0?void 0:S.children)||[])c.type==="track"&&h.view.showTrack(c.trackId)}},{label:"Hide all tracks",onClick:()=>{var S;for(const c of((S=X(_).get(p))===null||S===void 0?void 0:S.children)||[])c.type==="track"&&h.view.hideTrack(c.trackId)}},...s],onMenuItemClick:(S,c)=>{c(),o(null)},open:!!a,onClose:()=>{o(null)}}):null)}const Ir=L()(r=>({compactCheckbox:{padding:0},checkboxLabel:{marginRight:0,"&:hover":{backgroundColor:r.palette.action.selected}},selected:{background:"#cccc"}}));function Cr({data:r}){const{classes:e}=Ir(),{checked:t,conf:n,model:a,drawerPosition:o,id:s,trackId:l,name:h,onChange:p,selected:_}=r,S=Ae.readConfObject(n,"description");return d.createElement(d.Fragment,null,d.createElement(de,{title:S+(_?" (in selection)":""),placement:o==="left"?"right":"left"},d.createElement(st,{className:e.checkboxLabel,control:d.createElement(lt,{className:e.compactCheckbox,checked:t,onChange:()=>{p(l)},disabled:br(h),inputProps:{"data-testid":`htsTrackEntry-${s}`}}),label:d.createElement("div",{"data-testid":`htsTrackLabel-${s}`,style:{background:_?"#cccc":void 0}},d.createElement(Fe,{html:h}))})),d.createElement(Pe,{model:a,trackId:l,id:s,conf:n}))}const Er=L()(r=>({accordionBase:{display:"flex"},accordionCard:{padding:3,cursor:"pointer",display:"flex"},nestingLevelMarker:{position:"absolute",borderLeft:"1.5px solid #555"},accordionColor:{background:r.palette.tertiary.main,color:r.palette.tertiary.contrastText,width:"100%",display:"flex",paddingLeft:5}}));function kr({data:r,isOpen:e,style:t,setOpen:n}){const{isLeaf:a,nestingLevel:o}=r,{classes:s}=Er(),l=10,h=o*l+(a?l:0);return d.createElement("div",{style:t,className:a?void 0:s.accordionBase},new Array(o).fill(0).map((p,_)=>d.createElement("div",{key:`mark-${_}`,style:{left:_*l+4,height:t==null?void 0:t.height},className:s.nestingLevelMarker})),d.createElement("div",{className:a?void 0:s.accordionCard,style:{marginLeft:h,whiteSpace:"nowrap",width:"100%"}},d.createElement("div",{className:a?void 0:s.accordionColor},a?d.createElement(Cr,{data:r}):d.createElement(Tr,{isOpen:e,data:r,setOpen:n}))))}function Le(r,e,t,n){const a=r.type==="track",o=a?n[r.trackId]:!1;return{data:{defaultHeight:a?22:40,isLeaf:a,isOpenByDefault:!0,nestingLevel:e,selected:o,...r,...t},nestingLevel:e,node:r}}const We=M(function({height:e,tree:t,model:n}){const{filterText:a,selection:o,view:s}=n,l=C.useRef(null),h=k.getSession(n),{drawerPosition:p}=h,_=C.useMemo(()=>Object.fromEntries(o.map(v=>[v.trackId,v])),[o]),S=C.useMemo(()=>({onChange:v=>{s.toggleTrack(v)&&n.addToRecentlyUsed(v)},toggleCollapse:v=>{n.toggleCategory(v)},tree:t,model:n,drawerPosition:p}),[s,n,p,t]),c=C.useCallback(function*(){for(const T of t.children)yield Le(T,0,S,_);for(;;){const T=yield;for(const i of T.node.children)yield Le(i,T.nestingLevel+1,S,_)}},[t,S,_]);return C.useEffect(()=>{l.current.recomputeTree({refreshNodes:!0,useDefaultHeight:!0})},[t,a]),d.createElement(d.Fragment,null,d.createElement(hr,{ref:l,treeWalker:c,height:e},kr))}),zr=({tree:r,model:e,offset:t})=>typeof jest>"u"?d.createElement(ut,{disableWidth:!0},n=>d.createElement(We,{height:(n.height||t)-t,model:e,tree:r})):d.createElement(We,{height:9e3,model:e,tree:r}),xr=({overrideDimensions:r,children:e})=>r?d.createElement("div",{style:{...r}},e):e,wr=M(function({model:r,toolbarHeight:e,overrideDimensions:t}){return d.createElement(xr,{overrideDimensions:t},d.createElement(Mr,{model:r,toolbarHeight:e}),d.createElement(ht,{model:r}))}),Mr=M(function({model:r,toolbarHeight:e=0}){const[t,n]=C.useState(0);return d.createElement(d.Fragment,null,d.createElement(Ut,{model:r,setHeaderHeight:n}),d.createElement(zr,{tree:r.hierarchy,model:r,offset:e+t}))}),Lr=Object.freeze(Object.defineProperty({__proto__:null,default:wr},Symbol.toStringTag,{value:"Module"}));export{Lr as H,It as S,Pe as T};
