# module load BEDTools

mkdir logs

scratch_dir=$(echo $PWD | sed "s/\/data\/bi\/scratch_tmp/\/scratch/g")

ls *.bam | cut -d '_' -f1 | while read in; do echo "srun --partition short_idx --cpus-per-task 4 --mem 3850M --chdir $scratch_dir --time 01:00:00 --output logs/BAM2FQ.${in}.%j.log bedtools bamtofastq -i ${in}_R1.bam -fq ${in}.fastq &"; done > _01_bam2fq.sh

echo "find . -name '*.fastq' -exec srun --partition short_idx --cpus-per-task 5 --mem 3850M --chdir $scratch_dir --time 01:00:00 --output logs/PIGZ.%j.log pigz -p 5 {} \;" > _02_pgzip.sh
