(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{4032:(e,s,i)=>{Promise.resolve().then(i.bind(i,8962))},8962:(e,s,i)=>{"use strict";i.r(s),i.d(s,{default:()=>eS});var o=i(5155),n=i(2115),l=i(3166),r=i(3085),t=i(9949),a=i(5389),c=i(3420),d=i(9829),h=i(674),u=i(2403),x=i(4462),p=i(2369),j=i(3083),g=i(6677),m=i(2311),f=i(4252),b=i(4999),v=i(4825),_=i(7504),y=i(4619),C=i(7389),w=i(863),S=i(2295),k=i(5135),E=i(4681),O=i(3031),z=i(3792),D=i(1319);function P(){return"guest-"+Math.random().toString(36).substring(2,8)}function M(e){let[s,i]=(0,n.useState)(null);return(0,n.useEffect)(()=>{console.log("Attempting to connect to WebSocket server...");let s=(0,D.io)("http://pulse.local:5000",{transports:["websocket"],reconnection:!0,reconnectionAttempts:5,reconnectionDelay:1e3,auth:{clientId:(null==e?void 0:e.clientId)||"default-user"}});return s.on("connect",()=>{console.log("Connected to Python server")}),s.on("connect_error",e=>{console.error("Socket connection error:",e.message)}),s.on("disconnect",e=>{console.log("Socket disconnected:",e)}),["policies","uploaded_policies","policies_after_save","policies_after_delete"].forEach(e=>{s.on(e,s=>{console.log("".concat(e,":"),s)})}),["error_saving_policy","error_deleting_policy","error_interrupting_download"].forEach(e=>{s.on(e,s=>{console.error("".concat(e,":"),s)})}),s.on("authenticated",e=>{console.log("Authentication successful:",e)}),s.on("authentication_failed",e=>{console.error("Authentication failed:",e)}),s.on("mfa_required",e=>{console.log("MFA required:",e)}),s.on("download_progress",e=>{console.log("Download progress:",e)}),s.on("download_finished",e=>{console.log("Download finished:",e)}),s.on("download_failed",e=>{console.error("Download failed:",e)}),i(s),()=>{console.log("Cleaning up socket connection"),s.close()}},[null==e?void 0:e.clientId]),s}function R(e){let{label:s,info:i,children:n}=e,{isOpen:r,onToggle:a}=(0,l.j)();return(0,o.jsxs)(t.a,{children:[(0,o.jsxs)(h.z,{spacing:2,align:"center",mb:i&&r?2:0,children:[(0,o.jsx)(u.K,{"aria-label":"Toggle info",icon:r?(0,o.jsx)(O.M,{}):(0,o.jsx)(z.D,{}),size:"sm",variant:"ghost",onClick:a}),(0,o.jsx)(x.l,{flex:"1",mb:"0",children:s}),n]}),i&&(0,o.jsx)(p.S,{in:r,children:(0,o.jsx)(t.a,{pl:10,pr:4,py:2,bg:"gray.50",borderRadius:"md",children:(0,o.jsx)(j.E,{fontSize:"sm",color:"gray.600",children:i})})})]})}function F(e){let{isOpen:s,onClose:i,onPolicySaved:l,isEditing:a=!1,policy:h}=e,u=(0,r.d)(),x=M(),[p,O]=(0,n.useState)({name:(null==h?void 0:h.name)||"",username:(null==h?void 0:h.username)||"",directory:(null==h?void 0:h.directory)||"",domain:(null==h?void 0:h.domain)||"com",folder_structure:(null==h?void 0:h.folder_structure)||"{:%Y/%m/%d}",size:(null==h?void 0:h.size)||["original"],live_photo_size:(null==h?void 0:h.live_photo_size)||"original",force_size:(null==h?void 0:h.force_size)||!1,align_raw:(null==h?void 0:h.align_raw)||"original",keep_unicode_in_filenames:(null==h?void 0:h.keep_unicode_in_filenames)||!1,set_exif_datetime:(null==h?void 0:h.set_exif_datetime)||!1,live_photo_mov_filename_policy:(null==h?void 0:h.live_photo_mov_filename_policy)||"suffix",file_match_policy:(null==h?void 0:h.file_match_policy)||"name-size-dedup-with-suffix",xmp_sidecar:(null==h?void 0:h.xmp_sidecar)||!1,use_os_locale:(null==h?void 0:h.use_os_locale)||!1,album:(null==h?void 0:h.album)||"All Photos",library:(null==h?void 0:h.library)||"Personal Library",recent:(null==h?void 0:h.recent)||null,until_found:(null==h?void 0:h.until_found)||null,skip_videos:(null==h?void 0:h.skip_videos)||!1,skip_live_photos:(null==h?void 0:h.skip_live_photos)||!1,auto_delete:(null==h?void 0:h.auto_delete)||!1,delete_after_download:(null==h?void 0:h.delete_after_download)||!1,interval:(null==h?void 0:h.interval)||null,log_level:(null==h?void 0:h.log_level)||"info"});return(0,o.jsxs)(g.aF,{isOpen:s,onClose:i,isCentered:!0,motionPreset:"slideInBottom",size:"xl",scrollBehavior:"inside",children:[(0,o.jsx)(m.m,{backdropFilter:"blur(4px)"}),(0,o.jsxs)(f.$,{maxW:"800px",w:"90%",bg:"white",borderRadius:"2xl",boxShadow:"xl",children:[(0,o.jsx)(b.r,{fontFamily:"Inter, sans-serif",children:a?"Edit Policy":"New Policy"}),(0,o.jsx)(v.s,{}),(0,o.jsx)(_.c,{pb:6,children:(0,o.jsxs)(c.T,{spacing:4,align:"stretch",divider:(0,o.jsx)(t.a,{h:"1px",bg:"gray.100"}),children:[(0,o.jsxs)(t.a,{children:[(0,o.jsx)(j.E,{fontSize:"lg",fontWeight:"semibold",mb:4,children:"Basic Settings"}),(0,o.jsxs)(c.T,{spacing:4,align:"stretch",children:[(0,o.jsx)(y.MJ,{isRequired:!0,children:(0,o.jsx)(R,{label:"Policy Name",info:"A unique name to identify this policy",children:(0,o.jsx)(C.p,{value:p.name,onChange:e=>O({...p,name:e.target.value}),maxW:"300px"})})}),(0,o.jsx)(y.MJ,{isRequired:!0,children:(0,o.jsx)(R,{label:"iCloud Username",info:"Your iCloud account email address",children:(0,o.jsx)(C.p,{value:p.username,onChange:e=>O({...p,username:e.target.value}),maxW:"300px"})})}),(0,o.jsx)(y.MJ,{children:(0,o.jsx)(R,{label:"Domain",info:"The iCloud service domain to use",children:(0,o.jsxs)(w.l,{value:p.domain,onChange:e=>O({...p,domain:e.target.value}),maxW:"100px",children:[(0,o.jsx)("option",{value:"com",children:"com"}),(0,o.jsx)("option",{value:"cn",children:"cn"})]})})}),(0,o.jsx)(y.MJ,{isRequired:!0,children:(0,o.jsx)(R,{label:"Download Directory",info:"The local directory where photos will be downloaded",children:(0,o.jsx)(C.p,{value:p.directory,onChange:e=>O({...p,directory:e.target.value}),maxW:"300px"})})})]})]}),(0,o.jsxs)(t.a,{children:[(0,o.jsx)(j.E,{fontSize:"lg",fontWeight:"semibold",mb:4,children:"Download Options"}),(0,o.jsxs)(c.T,{spacing:4,align:"stretch",children:[(0,o.jsx)(y.MJ,{children:(0,o.jsx)(R,{label:"Folder Structure",info:"The folder structure pattern using Python's strftime format",children:(0,o.jsx)(C.p,{value:p.folder_structure,onChange:e=>O({...p,folder_structure:e.target.value}),maxW:"200px"})})}),(0,o.jsx)(y.MJ,{children:(0,o.jsx)(R,{label:"Live Photo Size",info:"The size of live photos to download",children:(0,o.jsxs)(w.l,{value:p.live_photo_size,onChange:e=>O({...p,live_photo_size:e.target.value}),maxW:"150px",children:[(0,o.jsx)("option",{value:"original",children:"Original"}),(0,o.jsx)("option",{value:"medium",children:"Medium"}),(0,o.jsx)("option",{value:"thumb",children:"Thumb"})]})})}),(0,o.jsx)(y.MJ,{children:(0,o.jsx)(R,{label:"Force Size",info:"Force a specific size when downloading photos",children:(0,o.jsx)(S.d,{checked:p.force_size,onChange:e=>O({...p,force_size:e.target.checked})})})}),(0,o.jsx)(y.MJ,{children:(0,o.jsx)(R,{label:"Keep Unicode in Filenames",info:"Preserve Unicode characters in filenames instead of converting them",children:(0,o.jsx)(S.d,{checked:p.keep_unicode_in_filenames,onChange:e=>O({...p,keep_unicode_in_filenames:e.target.checked})})})}),(0,o.jsx)(y.MJ,{children:(0,o.jsx)(R,{label:"Set EXIF Datetime",info:"Set the EXIF datetime in the downloaded photos",children:(0,o.jsx)(S.d,{checked:p.set_exif_datetime,onChange:e=>O({...p,set_exif_datetime:e.target.checked})})})}),(0,o.jsx)(y.MJ,{children:(0,o.jsx)(R,{label:"XMP Sidecar",info:"Create XMP sidecar files for the downloaded photos",children:(0,o.jsx)(S.d,{checked:p.xmp_sidecar,onChange:e=>O({...p,xmp_sidecar:e.target.checked})})})}),(0,o.jsx)(y.MJ,{children:(0,o.jsx)(R,{label:"Use OS Locale",info:"Use the operating system's locale settings",children:(0,o.jsx)(S.d,{checked:p.use_os_locale,onChange:e=>O({...p,use_os_locale:e.target.checked})})})})]})]}),(0,o.jsxs)(t.a,{children:[(0,o.jsx)(j.E,{fontSize:"lg",fontWeight:"semibold",mb:4,children:"Filter Options"}),(0,o.jsxs)(c.T,{spacing:4,align:"stretch",children:[(0,o.jsx)(y.MJ,{children:(0,o.jsx)(R,{label:"Album",info:"The album to download from. Choose from a list of albums when the policy is authenticated. Note that user-created albums only exist in Personal Library and trying to download them from a Shared Library will result in an error. Default: All Photos",children:(null==h?void 0:h.authenticated)&&h.albums?(0,o.jsx)(w.l,{value:h.albums.includes(p.album)?p.album:"",onChange:e=>O({...p,album:e.target.value}),maxW:"200px",placeholder:"Select an album",children:h.albums.map(e=>(0,o.jsx)("option",{value:e,children:e},e))}):(0,o.jsx)(C.p,{value:p.album,onChange:e=>O({...p,album:e.target.value}),maxW:"200px",placeholder:"Enter album name"})})}),(0,o.jsx)(y.MJ,{children:(0,o.jsx)(R,{label:"Library",info:"The library to download from. Personal Library will be used if you do not have a shared library. Default: Personal Library",children:(0,o.jsxs)(w.l,{value:p.library,onChange:e=>O({...p,library:e.target.value}),maxW:"200px",children:[(0,o.jsx)("option",{value:"Personal Library",children:"Personal Library"}),(0,o.jsx)("option",{value:"Shared Library",children:"Shared Library"})]})})}),(0,o.jsx)(y.MJ,{children:(0,o.jsx)(R,{label:"Download Recents",info:"Number of recent photos to download (leave empty for all)",children:(0,o.jsx)(k.Q7,{value:p.recent||"",onChange:e=>O({...p,recent:""===e?null:parseInt(e)}),min:0,maxW:"100px",children:(0,o.jsx)(k.OO,{})})})}),(0,o.jsx)(y.MJ,{children:(0,o.jsx)(R,{label:"Skip Videos",info:"Skip downloading video files",children:(0,o.jsx)(S.d,{checked:p.skip_videos,onChange:e=>O({...p,skip_videos:e.target.checked})})})}),(0,o.jsx)(y.MJ,{children:(0,o.jsx)(R,{label:"Skip Live Photos",info:"Skip downloading live photos",children:(0,o.jsx)(S.d,{checked:p.skip_live_photos,onChange:e=>O({...p,skip_live_photos:e.target.checked})})})})]})]}),(0,o.jsxs)(t.a,{children:[(0,o.jsx)(j.E,{fontSize:"lg",fontWeight:"semibold",mb:4,children:"Delete Options"}),(0,o.jsxs)(c.T,{spacing:4,align:"stretch",children:[(0,o.jsx)(y.MJ,{children:(0,o.jsx)(R,{label:"Auto Delete",info:"Automatically delete photos that are no longer in iCloud",children:(0,o.jsx)(S.d,{checked:p.auto_delete,onChange:e=>O({...p,auto_delete:e.target.checked})})})}),(0,o.jsx)(y.MJ,{children:(0,o.jsx)(R,{label:"Delete After Download",info:"Delete photos from iCloud after successful download",children:(0,o.jsx)(S.d,{checked:p.delete_after_download,onChange:e=>O({...p,delete_after_download:e.target.checked})})})})]})]}),(0,o.jsxs)(t.a,{children:[(0,o.jsx)(j.E,{fontSize:"lg",fontWeight:"semibold",mb:4,children:"UI Options"}),(0,o.jsxs)(c.T,{spacing:4,align:"stretch",children:[(0,o.jsx)(y.MJ,{children:(0,o.jsx)(R,{label:"Sync Interval (minutes)",info:"How often to automatically sync photos (leave empty for manual sync)",children:(0,o.jsx)(k.Q7,{value:p.interval||"",onChange:e=>O({...p,interval:""===e?null:parseInt(e)}),min:0,maxW:"100px",children:(0,o.jsx)(k.OO,{})})})}),(0,o.jsx)(y.MJ,{children:(0,o.jsx)(R,{label:"Log Level",info:"The level of detail in log messages",children:(0,o.jsxs)(w.l,{value:p.log_level,onChange:e=>O({...p,log_level:e.target.value}),maxW:"150px",children:[(0,o.jsx)("option",{value:"debug",children:"Debug"}),(0,o.jsx)("option",{value:"info",children:"Info"}),(0,o.jsx)("option",{value:"error",children:"Error"})]})})})]})]})]})}),(0,o.jsxs)(E.j,{children:[(0,o.jsx)(d.$,{bg:"black",color:"white",_hover:{bg:"gray.800"},mr:3,borderRadius:"xl",fontFamily:"Inter, sans-serif",onClick:()=>{if(!x)return;let e=a?"policies_after_save":"policies_after_create";x.once(e,e=>{u({title:"Success",description:'Policy "'.concat(p.name,'" ').concat(a?"saved":"created"," successfully"),status:"success",duration:3e3,isClosable:!0}),i(),l&&l(e)}),x.once(a?"error_saving_policy":"error_creating_policy",s=>{let{policy_name:i,error:o}=s;u({title:"Error",description:"Failed to ".concat(a?"save":"create",' policy "').concat(i,'": ').concat(o),status:"error",duration:5e3,isClosable:!0}),x.off(e)}),a?x.emit("savePolicy",null==h?void 0:h.name,p):x.emit("createPolicy",p)},children:"Save"}),(0,o.jsx)(d.$,{onClick:i,borderRadius:"xl",fontFamily:"Inter, sans-serif",variant:"ghost",_hover:{bg:"gray.100"},children:"Cancel"})]})]})]})}var A=i(1911);function W(e){let{isOpen:s,onClose:i,onConfirm:l,policyName:r}=e,t=(0,n.useRef)(null);return(0,o.jsx)(A.Lt,{isOpen:s,leastDestructiveRef:t,onClose:i,isCentered:!0,children:(0,o.jsx)(m.m,{children:(0,o.jsxs)(A.EO,{borderRadius:"xl",children:[(0,o.jsx)(b.r,{fontSize:"lg",fontWeight:"bold",children:"Delete Policy"}),(0,o.jsxs)(_.c,{children:['Are you sure you want to delete policy "',r,'"? This action cannot be undone.']}),(0,o.jsxs)(E.j,{children:[(0,o.jsx)(d.$,{ref:t,onClick:i,borderRadius:"xl",children:"Cancel"}),(0,o.jsx)(d.$,{colorScheme:"red",onClick:()=>{l(),i()},ml:3,borderRadius:"xl",children:"Delete"})]})]})})})}var I=i(2533),L=i(5442);function T(e){let{onSettingsClick:s}=e;return(0,o.jsx)(t.a,{bg:"white",borderBottom:"1px",borderColor:"gray.200",py:4,position:"sticky",top:0,zIndex:1,children:(0,o.jsx)(t.a,{mx:"auto",width:"100%",children:(0,o.jsxs)(I.s,{maxW:"container.xl",mx:"auto",width:"100%",justify:"space-between",align:"center",pr:6,children:[(0,o.jsx)(L.D,{fontSize:"24px",fontWeight:"bold",fontFamily:"Inter, sans-serif",color:"black",children:"iCloud Photos Downloader"}),(0,o.jsxs)(I.s,{gap:4,align:"center",children:[(0,o.jsx)(t.a,{as:"a",href:"https://github.com/AirswitchAsa/icloudpd-web",target:"_blank",rel:"noopener noreferrer",color:"gray.600",_hover:{color:"gray.800",cursor:"pointer"},fontFamily:"Inter, sans-serif",fontSize:"14px",fontWeight:"semibold",children:"Github"}),(0,o.jsx)(t.a,{as:"span",color:"gray.600",_hover:{color:"gray.800",cursor:"pointer"},fontFamily:"Inter, sans-serif",fontSize:"14px",fontWeight:"semibold",onClick:s,children:"Settings"})]})]})})})}var J=i(1683);function $(e){let{title:s,children:i,headerRight:n,...l}=e;return(0,o.jsx)(t.a,{width:"100%",...l,children:(0,o.jsxs)(t.a,{bg:"white",borderRadius:"2xl",boxShadow:"sm",border:"1px",borderColor:"gray.200",display:"flex",flexDirection:"column",children:[(0,o.jsxs)(I.s,{px:12,borderBottom:"1px",borderColor:"gray.100",height:"56px",alignItems:"center",children:[(0,o.jsx)(j.E,{fontSize:"14px",fontWeight:"semibold",color:"gray.600",letterSpacing:"0.05em",pl:2,children:s.toUpperCase()}),(0,o.jsx)(J.h,{}),n]}),(0,o.jsx)(t.a,{pt:2,pb:10,px:12,flex:"1",minH:"200px",display:"flex",alignItems:"flex-start",width:"100%",children:i})]})})}var K=i(206),U=i(1889),N=i(4893),q=i(4605),H=i(6317),B=i(6434),G=i(6344),Y=i(921),X=i(1536);let V=e=>{let{isOpen:s,onClose:i,onConfirm:l,policyName:r}=e,t=(0,n.useRef)(null);return(0,o.jsx)(A.Lt,{isOpen:s,leastDestructiveRef:t,onClose:i,children:(0,o.jsx)(m.m,{children:(0,o.jsxs)(A.EO,{children:[(0,o.jsx)(b.r,{fontSize:"lg",fontWeight:"bold",children:"Interrupt Download"}),(0,o.jsxs)(_.c,{children:["Are you sure you want to interrupt the policy ",r,"? All downloaded files will be kept."]}),(0,o.jsxs)(E.j,{children:[(0,o.jsx)(d.$,{ref:t,onClick:i,children:"Cancel"}),(0,o.jsx)(d.$,{colorScheme:"red",onClick:l,ml:3,children:"Confirm"})]})]})})})},Q=e=>{let{policy:s,setPolicies:i,onEdit:r,onDelete:a,onRun:c,onInterrupt:h,socket:x,toast:g}=e,{isOpen:m,onToggle:f}=(0,l.j)(),{isOpen:b,onOpen:v,onClose:_}=(0,l.j)(),[y,C]=(0,n.useState)(!1);(0,n.useEffect)(()=>{"running"===s.status&&C(!1)},[s.status]);let w=(e=>"running"===e.status?{text:"running",color:"blue.500"}:"errored"===e.status?{text:"errored",color:"red.500"}:e.authenticated?100===e.progress?{text:"done",color:"green.500"}:{text:"ready",color:"green.500"}:{text:"unauthenticated",color:"gray.500"})(s);return(0,o.jsxs)(t.a,{width:"100%",borderWidth:"1px",borderRadius:"lg",overflow:"hidden",children:[(0,o.jsxs)(I.s,{p:4,justify:"space-between",align:"center",bg:m?"gray.50":"white",onClick:f,cursor:"pointer",_hover:{bg:"gray.50"},children:[(0,o.jsxs)(I.s,{flex:1,gap:4,children:[(0,o.jsx)(u.K,{"aria-label":"Expand row",icon:m?(0,o.jsx)(O.M,{}):(0,o.jsx)(z.D,{}),variant:"ghost",size:"sm"}),(0,o.jsxs)(t.a,{flex:1,children:[(0,o.jsx)(j.E,{fontSize:"16px",fontWeight:"medium",children:s.name}),(0,o.jsxs)(I.s,{gap:2,color:"gray.500",fontSize:"14px",children:[(0,o.jsx)(j.E,{color:w.color,fontWeight:"medium",children:w.text}),(0,o.jsx)(j.E,{children:"•"}),(0,o.jsx)(j.E,{children:s.username}),(0,o.jsx)(j.E,{children:"•"}),(0,o.jsx)(j.E,{children:s.directory})]})]}),(0,o.jsx)(t.a,{width:"150px",display:"flex",children:(0,o.jsxs)(t.a,{flex:"1",mt:1,children:[(0,o.jsx)(j.E,{fontSize:"12px",color:"gray.600",fontWeight:"medium",children:"running"===s.status?"".concat(s.progress||0,"%"):"IDLE"}),(0,o.jsx)(q.k,{value:s.progress||0,size:"sm",colorScheme:"running"===s.status?"blue":"errored"===s.status?"red":"green",borderRadius:"full"})]})})]}),(0,o.jsxs)(I.s,{gap:2,ml:4,children:[y?(0,o.jsx)(u.K,{"aria-label":"Loading",icon:(0,o.jsx)(N.y,{size:"sm"}),colorScheme:"blue",variant:"ghost",size:"sm"}):"running"===s.status?(0,o.jsx)(u.K,{"aria-label":"Pause download",icon:(0,o.jsx)(X.kwt,{}),colorScheme:"blue",variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),v()}}):(0,o.jsx)(u.K,{"aria-label":"Run policy",icon:(0,o.jsx)(X.gSK,{}),colorScheme:"green",variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),x&&s.authenticated&&(C(!0),x.once("icloud_is_busy",()=>{C(!1)}),x.once("download_failed",()=>{C(!1)})),c(s)}}),(0,o.jsx)(u.K,{"aria-label":"Edit policy",icon:(0,o.jsx)(H.q,{}),colorScheme:"blue",variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),r(s)},isDisabled:"running"===s.status}),(0,o.jsx)(u.K,{"aria-label":"Duplicate policy",icon:(0,o.jsx)(B.T,{}),colorScheme:"blue",variant:"ghost",size:"sm",onClick:e=>{if(e.stopPropagation(),!x)return;let o={...s,name:"".concat(s.name," COPY"),authenticated:!1};x.once("policies_after_create",e=>{i(e)}),x.once("error_creating_policy",e=>{let{policy_name:s,error:i}=e;g({title:"Error",description:'Failed to create policy "'.concat(s,'": ').concat(i),status:"error",duration:5e3,isClosable:!0})}),x.emit("createPolicy",o)},isDisabled:"running"===s.status}),(0,o.jsx)(u.K,{"aria-label":"Delete policy",icon:(0,o.jsx)(G.d,{}),colorScheme:"red",variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),a(s)},isDisabled:"running"===s.status})]})]}),(0,o.jsx)(V,{isOpen:b,onClose:_,onConfirm:()=>{h(s),_()},policyName:s.name}),(0,o.jsx)(p.S,{in:m,children:(0,o.jsxs)(t.a,{p:4,bg:"gray.50",children:[(0,o.jsx)(t.a,{ml:12,maxH:"300px",overflowY:"auto",sx:{"&::-webkit-scrollbar":{width:"8px",borderRadius:"8px",backgroundColor:"rgba(0, 0, 0, 0.05)"},"&::-webkit-scrollbar-thumb":{backgroundColor:"rgba(0, 0, 0, 0.1)",borderRadius:"8px","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.15)"}}},children:(0,o.jsx)(j.E,{fontSize:"14px",fontFamily:"monospace",whiteSpace:"pre-wrap",sx:{wordBreak:"break-word"},children:s.logs||"No logs available"})}),s.logs&&"running"!==s.status&&(0,o.jsx)(I.s,{justify:"flex-start",mt:4,ml:12,children:(0,o.jsx)(d.$,{leftIcon:(0,o.jsx)(Y.s,{}),size:"sm",variant:"outline",colorScheme:"blue",onClick:e=>{if(e.stopPropagation(),!s.logs)return;let i=new Blob([s.logs],{type:"text/plain"}),o=URL.createObjectURL(i),n=document.createElement("a");n.href=o,n.download="".concat(s.name,"-logs.txt"),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(o)},children:"Export Logs"})})]})})]})},Z=e=>{let{isOpen:s,onClose:i,onImport:n}=e;return(0,o.jsxs)(g.aF,{isOpen:s,onClose:i,children:[(0,o.jsx)(m.m,{}),(0,o.jsxs)(f.$,{children:[(0,o.jsx)(b.r,{children:"Import Policies"}),(0,o.jsx)(v.s,{}),(0,o.jsx)(_.c,{children:(0,o.jsx)(j.E,{children:"Select a TOML file containing policy definitions to import."})}),(0,o.jsx)(E.j,{children:(0,o.jsx)(d.$,{colorScheme:"blue",onClick:n,children:"Choose File"})})]})]})},ee=e=>{let{isOpen:s,onClose:i,onExport:n}=e;return(0,o.jsxs)(g.aF,{isOpen:s,onClose:i,children:[(0,o.jsx)(m.m,{}),(0,o.jsxs)(f.$,{children:[(0,o.jsx)(b.r,{children:"Export Policies"}),(0,o.jsx)(v.s,{}),(0,o.jsx)(_.c,{children:(0,o.jsx)(j.E,{children:"Download your policies as a TOML file."})}),(0,o.jsx)(E.j,{children:(0,o.jsx)(d.$,{colorScheme:"blue",onClick:n,children:"Download"})})]})]})};var es=i(8613),ei=i(5184),eo=i(9616),en=i(2863),el=i(1741),er=i(3129),et=i(9365),ea=i(6152),ec=i(6084);let ed=e=>{let{selectedUsernames:s,setSelectedUsernames:i,uniqueUsernames:n}=e;return(0,o.jsxs)(es.W,{children:[(0,o.jsx)(ei.I,{as:u.K,"aria-label":"Filter policies",icon:(0,o.jsx)(ea.R,{}),variant:"ghost",colorScheme:"gray"}),(0,o.jsx)(eo.c,{children:(0,o.jsx)(t.a,{px:4,py:2,children:(0,o.jsx)(en.$,{value:s,onChange:e=>i(e),children:(0,o.jsxs)(el.B,{children:[(0,o.jsx)(er.S,{value:"All",onChange:e=>{e.target.checked?i(["All"]):i([])},children:"All"}),n.map(e=>(0,o.jsx)(er.S,{value:e,isChecked:s.includes(e),onChange:o=>{o.target.checked?s.includes("All")?i([e]):i([...s,e]):i(s.filter(s=>s!==e))},children:e},e))]})})})})]})},eh=e=>{let{setSortOrder:s}=e;return(0,o.jsxs)(es.W,{children:[(0,o.jsx)(ei.I,{as:u.K,"aria-label":"Sort policies",icon:(0,o.jsx)(ec.Dwj,{}),variant:"ghost",colorScheme:"gray"}),(0,o.jsxs)(eo.c,{children:[(0,o.jsx)(et.D,{onClick:()=>s("asc"),children:"Name: A to Z"}),(0,o.jsx)(et.D,{onClick:()=>s("desc"),children:"Name: Z to A"})]})]})},eu=e=>{let{policies:s,setPolicies:i,onEdit:r,onDelete:a,onRun:d,onInterrupt:h,socket:x,toast:p}=e,[g,m]=(0,n.useState)(s),[f,b]=(0,n.useState)(["All"]),[v,_]=(0,n.useState)("none"),y=(0,n.useRef)(null),{isOpen:C,onOpen:w,onClose:S}=(0,l.j)(),{isOpen:k,onOpen:E,onClose:O}=(0,l.j)(),z=Array.from(new Set(s.map(e=>e.username)));(0,n.useEffect)(()=>{let e=[...s];f.includes("All")||(e=e.filter(e=>f.includes(e.username))),"none"!==v&&e.sort((e,s)=>"asc"===v?e.name.localeCompare(s.name):s.name.localeCompare(e.name)),m(e)},[s,f,v]);let D=async e=>{var s;let o=null===(s=e.target.files)||void 0===s?void 0:s[0];if(!o||!x)return;let n=await o.text();x.emit("uploadPolicies",n),x.once("uploaded_policies",e=>{i(e),p({title:"Success",description:"Policies imported successfully",status:"success",duration:3e3,isClosable:!0})}),x.once("error_uploading_policies",e=>{let{error:s}=e;p({title:"Error",description:"Failed to import policies: ".concat(s),status:"error",duration:5e3,isClosable:!0})}),S(),y.current&&(y.current.value="")};return(0,o.jsxs)(c.T,{spacing:2,width:"100%",align:"stretch",children:[(0,o.jsxs)(I.s,{justify:"space-between",gap:2,children:[(0,o.jsxs)(I.s,{gap:2,children:[(0,o.jsx)("input",{type:"file",ref:y,onChange:D,accept:".toml",style:{display:"none"}}),(0,o.jsx)(u.K,{"aria-label":"Import policies",icon:(0,o.jsx)(K.ekc,{}),onClick:w,variant:"ghost",colorScheme:"gray"}),(0,o.jsx)(u.K,{"aria-label":"Export policies",icon:(0,o.jsx)(U.bOW,{}),onClick:E,variant:"ghost",colorScheme:"gray"})]}),(0,o.jsxs)(I.s,{gap:2,children:[(0,o.jsx)(ed,{selectedUsernames:f,setSelectedUsernames:b,uniqueUsernames:z}),(0,o.jsx)(eh,{setSortOrder:_})]})]}),(0,o.jsx)(Z,{isOpen:C,onClose:S,onImport:()=>{var e;null===(e=y.current)||void 0===e||e.click()}}),(0,o.jsx)(ee,{isOpen:k,onClose:O,onExport:()=>{x&&(x.emit("downloadPolicies"),x.once("error_downloading_policies",e=>{let{error:s}=e;p({title:"Error",description:"Failed to export policies: ".concat(s),status:"error",duration:5e3,isClosable:!0})}),x.once("downloaded_policies",e=>{let s=new Blob([e],{type:"text/plain"}),i=URL.createObjectURL(s),o=document.createElement("a");o.href=i,o.download="policies.toml",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(i),O()}))}}),g.length>0?g.map(e=>(0,o.jsx)(Q,{policy:e,setPolicies:i,onEdit:r,onDelete:a,onRun:d,onInterrupt:h,socket:x,toast:p},e.name)):(0,o.jsx)(t.a,{height:"100px",display:"grid",placeItems:"center",children:(0,o.jsx)(j.E,{color:"gray.500",textAlign:"center",fontFamily:"Inter, sans-serif",fontSize:"14px",children:"No policies found"})})]})};var ex=i(7511),ep=i(6758),ej=i(4895),eg=i(6742);function em(e){let{isOpen:s,onClose:i,onSubmit:l,username:r,socket:t}=e,[a,c]=(0,n.useState)(""),[h,p]=(0,n.useState)(!1),[v,w]=(0,n.useState)(!1),S=()=>{t&&(w(!0),t.once("authenticated",()=>{w(!1),i()}),t.once("authentication_failed",()=>{w(!1)}),l(a),c(""))};return(0,o.jsxs)(g.aF,{isOpen:s,onClose:i,isCentered:!0,children:[(0,o.jsx)(m.m,{backdropFilter:"blur(4px)"}),(0,o.jsxs)(f.$,{borderRadius:"xl",children:[(0,o.jsx)(b.r,{children:"Authentication Required"}),(0,o.jsx)(_.c,{children:(0,o.jsxs)(y.MJ,{children:[(0,o.jsx)(x.l,{children:v?(0,o.jsx)(I.s,{gap:2,align:"center",children:(0,o.jsx)(j.E,{children:"Authenticating..."})}):"Enter the password for iCloud user ".concat(r)}),(0,o.jsxs)(ex.M,{children:[(0,o.jsx)(C.p,{type:h?"text":"password",value:a,onChange:e=>c(e.target.value),onKeyDown:e=>{"Enter"===e.key&&a&&S()}}),(0,o.jsx)(ep.t,{children:(0,o.jsx)(u.K,{"aria-label":h?"Hide password":"Show password",icon:h?(0,o.jsx)(ej.O,{}):(0,o.jsx)(eg.t,{}),variant:"ghost",onClick:()=>p(!h),size:"sm"})})]})]})}),(0,o.jsxs)(E.j,{children:[(0,o.jsx)(d.$,{variant:"ghost",mr:3,onClick:i,children:"Cancel"}),(0,o.jsx)(d.$,{colorScheme:"blue",onClick:S,isDisabled:!a||v,isLoading:v,children:"Submit"})]})]})]})}function ef(e){let{isOpen:s,onClose:i,onSubmit:l,error:r,socket:t}=e,[a,h]=(0,n.useState)(""),[u,p]=(0,n.useState)(!1),v=()=>{t&&(p(!0),t.once("authenticated",()=>{p(!1),i()}),t.once("authentication_failed",()=>{p(!1)}),t.once("mfa_required",()=>{p(!1)}),l(a),h(""))};return(0,o.jsxs)(g.aF,{isOpen:s,onClose:i,isCentered:!0,children:[(0,o.jsx)(m.m,{backdropFilter:"blur(4px)"}),(0,o.jsxs)(f.$,{borderRadius:"xl",children:[(0,o.jsx)(b.r,{children:"Two-Factor Authentication"}),(0,o.jsx)(_.c,{children:(0,o.jsxs)(c.T,{spacing:4,align:"stretch",children:[(0,o.jsxs)(y.MJ,{children:[(0,o.jsx)(x.l,{children:u?(0,o.jsx)(I.s,{gap:2,align:"center",children:(0,o.jsx)(j.E,{children:"Verifying..."})}):"Verification code is sent to your trusted devices"}),(0,o.jsx)(C.p,{type:"text",value:a,onChange:e=>h(e.target.value),onKeyDown:e=>{"Enter"===e.key&&a&&v()},placeholder:"Enter code",isDisabled:u})]}),r&&(0,o.jsx)(j.E,{color:"red.500",fontSize:"sm",children:r})]})}),(0,o.jsxs)(E.j,{children:[(0,o.jsx)(d.$,{variant:"ghost",mr:3,onClick:i,isDisabled:u,children:"Cancel"}),(0,o.jsx)(d.$,{colorScheme:"blue",onClick:v,isDisabled:!a||u,isLoading:u,children:"Submit"})]})]})]})}var eb=i(3983),ev=i(3750);function e_(e){let{isOpen:s,socket:i,onAuthenticated:r}=e,[t,a]=(0,n.useState)(""),[p,v]=(0,n.useState)(!1),[w,S]=(0,n.useState)(!1),[k,O]=(0,n.useState)(),[z,D]=(0,n.useState)(""),[M,R]=(0,n.useState)(""),[F,A]=(0,n.useState)(!1),[W,I]=(0,n.useState)(!1),[L,T]=(0,n.useState)(!1),[J,$]=(0,n.useState)({no_password:!1,always_guest:!1,disable_guest:!1}),{isOpen:K,onOpen:U,onClose:N}=(0,l.j)(),q=z===M,H=""!==M&&!q;(0,n.useEffect)(()=>{if(i)return i.emit("getServerConfig"),i.on("server_config",e=>{$(e)}),()=>{i.off("server_config")}},[i]),(0,n.useEffect)(()=>{J.no_password?r("default-user",!1):J.always_guest&&r(P(),!0)},[J,r]);let B=()=>{i&&(S(!0),O(void 0),i.emit("authenticate_local",t))},G=()=>{i&&q&&(T(!0),O(void 0),i.emit("save_secret","",z))};return null==i||i.once("server_authenticated",()=>{S(!1),a(""),r("default-user",!1)}),null==i||i.once("server_authentication_failed",e=>{S(!1),O(e.error)}),null==i||i.once("server_secret_reset",()=>{O(void 0),a(""),U()}),null==i||i.once("failed_resetting_server_secret",e=>{O(e.error)}),null==i||i.once("server_secret_saved",()=>{T(!1),D(""),R(""),N()}),null==i||i.once("failed_saving_server_secret",e=>{T(!1),O(e.error)}),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(g.aF,{isOpen:s,onClose:()=>{},isCentered:!0,closeOnOverlayClick:!1,closeOnEsc:!1,children:[(0,o.jsx)(m.m,{backdropFilter:"blur(4px)"}),(0,o.jsxs)(f.$,{borderRadius:"xl",children:[(0,o.jsx)(b.r,{children:"Server Authentication"}),(0,o.jsx)(_.c,{children:(0,o.jsxs)(c.T,{spacing:4,children:[(0,o.jsxs)(y.MJ,{children:[(0,o.jsx)(x.l,{children:w?"Authenticating...":"Enter server password"}),(0,o.jsxs)(ex.M,{children:[(0,o.jsx)(C.p,{type:p?"text":"password",value:t,onChange:e=>a(e.target.value),onKeyDown:e=>{"Enter"===e.key&&t&&B()}}),(0,o.jsx)(ep.t,{children:(0,o.jsx)(u.K,{"aria-label":p?"Hide password":"Show password",icon:p?(0,o.jsx)(ej.O,{}):(0,o.jsx)(eg.t,{}),variant:"ghost",onClick:()=>v(!p),size:"sm"})})]})]}),k&&(0,o.jsx)(j.E,{color:"red.500",fontSize:"sm",children:k}),(0,o.jsxs)(h.z,{spacing:4,width:"100%",justify:"space-between",children:[(0,o.jsx)(eb.N,{color:"blue.500",onClick:()=>{i&&i.emit("reset_secret")},textDecoration:"underline",cursor:"pointer",children:"Reset server secret"}),!J.disable_guest&&(0,o.jsx)(eb.N,{color:"blue.500",onClick:()=>{r(P(),!0)},textDecoration:"underline",cursor:"pointer",children:"Continue as guest"})]})]})}),(0,o.jsx)(E.j,{children:(0,o.jsx)(d.$,{bg:"black",color:"white",_hover:{bg:"gray.800"},onClick:B,isDisabled:!t||w,isLoading:w,children:"Submit"})})]})]}),(0,o.jsxs)(g.aF,{isOpen:K,onClose:()=>{},isCentered:!0,closeOnOverlayClick:!1,closeOnEsc:!1,children:[(0,o.jsx)(m.m,{backdropFilter:"blur(4px)"}),(0,o.jsxs)(f.$,{borderRadius:"xl",children:[(0,o.jsx)(b.r,{children:"Set New Password"}),(0,o.jsx)(_.c,{children:(0,o.jsxs)(c.T,{spacing:4,children:[(0,o.jsxs)(y.MJ,{isInvalid:H,children:[(0,o.jsx)(x.l,{children:"New Password"}),(0,o.jsxs)(ex.M,{children:[(0,o.jsx)(C.p,{type:F?"text":"password",value:z,onChange:e=>D(e.target.value),onKeyDown:e=>{"Enter"===e.key&&z&&q&&G()}}),(0,o.jsx)(ep.t,{children:(0,o.jsx)(u.K,{"aria-label":F?"Hide password":"Show password",icon:F?(0,o.jsx)(ej.O,{}):(0,o.jsx)(eg.t,{}),variant:"ghost",onClick:()=>A(!F),size:"sm"})})]})]}),(0,o.jsxs)(y.MJ,{isInvalid:H,children:[(0,o.jsx)(x.l,{children:"Confirm Password"}),(0,o.jsxs)(ex.M,{children:[(0,o.jsx)(C.p,{type:W?"text":"password",value:M,onChange:e=>R(e.target.value),onKeyDown:e=>{"Enter"===e.key&&M&&q&&G()}}),(0,o.jsx)(ep.t,{children:(0,o.jsx)(u.K,{"aria-label":W?"Hide password":"Show password",icon:W?(0,o.jsx)(ej.O,{}):(0,o.jsx)(eg.t,{}),variant:"ghost",onClick:()=>I(!W),size:"sm"})})]}),H&&(0,o.jsx)(ev.Wt,{children:"Passwords do not match"})]}),k&&(0,o.jsx)(j.E,{color:"red.500",fontSize:"sm",children:k})]})}),(0,o.jsx)(E.j,{children:(0,o.jsx)(d.$,{bg:"black",color:"white",_hover:{bg:"gray.800"},onClick:G,isDisabled:!z||!M||!q||L,isLoading:L,children:"Set Password"})})]})]})]})}function ey(){return(0,o.jsx)(t.a,{children:(0,o.jsx)(c.T,{spacing:6,align:"stretch",children:(0,o.jsx)(j.E,{color:"gray.500",children:"There are no general settings at the moment."})})})}let eC=[{id:"general",label:"General",component:ey},{id:"download",label:"Download",component:function(){return(0,o.jsx)(t.a,{children:(0,o.jsx)(c.T,{spacing:6,align:"stretch",children:(0,o.jsx)(j.E,{color:"gray.500",children:"There are no download settings at the moment."})})})}},{id:"user",label:"User",component:function(e){let{socket:s,isGuest:i}=e,[l,a]=(0,n.useState)(""),[h,p]=(0,n.useState)(""),[g,m]=(0,n.useState)(""),[f,b]=(0,n.useState)(!1),[v,_]=(0,n.useState)(!1),[w,k]=(0,n.useState)(!1),[E,O]=(0,n.useState)(!1),[z,D]=(0,n.useState)({no_password:!1,always_guest:!1,disable_guest:!1}),P=(0,r.d)(),M=h===g,R=""!==g&&!M;(0,n.useEffect)(()=>{if(s)return s.emit("getServerConfig"),s.on("server_config",e=>{D(e)}),()=>{s.off("server_config")}},[s]);let F=e=>i=>{s&&(s.once("app_config_updated",()=>{D(s=>({...s,[e]:i})),P({title:"Success",description:"Access control settings updated",status:"success",duration:3e3,isClosable:!0})}),s.once("error_updating_app_config",e=>{s.emit("getServerConfig"),P({title:"Error",description:e.error,status:"error",duration:5e3,isClosable:!0})}),s.emit("updateAppConfig",e,i))};return(0,o.jsx)(t.a,{children:(0,o.jsxs)(c.T,{spacing:8,align:"stretch",children:[(0,o.jsxs)(t.a,{children:[(0,o.jsx)(j.E,{fontWeight:"bold",fontSize:"lg",mb:4,children:"Change Password"}),(0,o.jsxs)(c.T,{spacing:3,align:"stretch",maxW:"400px",children:[(0,o.jsxs)(y.MJ,{children:[(0,o.jsx)(x.l,{fontSize:"sm",children:"Current Password"}),(0,o.jsxs)(ex.M,{size:"sm",children:[(0,o.jsx)(C.p,{type:f?"text":"password",value:l,onChange:e=>a(e.target.value)}),(0,o.jsx)(ep.t,{children:(0,o.jsx)(u.K,{"aria-label":f?"Hide password":"Show password",icon:f?(0,o.jsx)(ej.O,{}):(0,o.jsx)(eg.t,{}),variant:"ghost",onClick:()=>b(!f),size:"sm"})})]})]}),(0,o.jsxs)(y.MJ,{isInvalid:R,children:[(0,o.jsx)(x.l,{fontSize:"sm",children:"New Password"}),(0,o.jsxs)(ex.M,{size:"sm",children:[(0,o.jsx)(C.p,{type:v?"text":"password",value:h,onChange:e=>p(e.target.value)}),(0,o.jsx)(ep.t,{children:(0,o.jsx)(u.K,{"aria-label":v?"Hide password":"Show password",icon:v?(0,o.jsx)(ej.O,{}):(0,o.jsx)(eg.t,{}),variant:"ghost",onClick:()=>_(!v),size:"sm"})})]})]}),(0,o.jsxs)(y.MJ,{isInvalid:R,children:[(0,o.jsx)(x.l,{fontSize:"sm",children:"Confirm New Password"}),(0,o.jsxs)(ex.M,{size:"sm",children:[(0,o.jsx)(C.p,{type:w?"text":"password",value:g,onChange:e=>m(e.target.value)}),(0,o.jsx)(ep.t,{children:(0,o.jsx)(u.K,{"aria-label":w?"Hide password":"Show password",icon:w?(0,o.jsx)(ej.O,{}):(0,o.jsx)(eg.t,{}),variant:"ghost",onClick:()=>k(!w),size:"sm"})})]}),R&&(0,o.jsx)(ev.Wt,{children:"Passwords do not match"})]}),(0,o.jsx)(t.a,{pt:2,children:(0,o.jsx)(d.$,{bg:"black",color:"white",_hover:{bg:"gray.800"},onClick:()=>{s&&M&&(O(!0),s.once("server_secret_saved",()=>{O(!1),a(""),p(""),m(""),P({title:"Success",description:"Server password has been updated",status:"success",duration:3e3,isClosable:!0})}),s.once("failed_saving_server_secret",e=>{O(!1),P({title:"Error",description:e.error,status:"error",duration:5e3,isClosable:!0})}),s.emit("save_secret",l,h))},isDisabled:!l||!h||!g||!M||E||i,isLoading:E,size:"sm",children:"Update Password"})})]})]}),(0,o.jsxs)(t.a,{children:[(0,o.jsx)(j.E,{fontWeight:"bold",fontSize:"lg",mb:4,children:"Access Control"}),(0,o.jsxs)(c.T,{spacing:3,align:"stretch",maxW:"400px",children:[(0,o.jsxs)(y.MJ,{children:[(0,o.jsx)(x.l,{fontSize:"sm",children:"No Password Required"}),(0,o.jsx)(S.d,{isChecked:z.no_password,onChange:e=>F("no_password")(e.target.checked),isDisabled:i})]}),(0,o.jsxs)(y.MJ,{children:[(0,o.jsx)(x.l,{fontSize:"sm",children:"Always Use Guest Mode"}),(0,o.jsx)(S.d,{isChecked:z.always_guest,onChange:e=>F("always_guest")(e.target.checked),isDisabled:i&&!z.always_guest})]}),(0,o.jsxs)(y.MJ,{children:[(0,o.jsx)(x.l,{fontSize:"sm",children:"Disable Guest Access"}),(0,o.jsx)(S.d,{isChecked:z.disable_guest,onChange:e=>F("disable_guest")(e.target.checked),isDisabled:i})]})]})]})]})})}}];function ew(e){var s;let{isOpen:i,onClose:l,socket:r,isGuest:a}=e,[h,u]=(0,n.useState)("general"),x=(null===(s=eC.find(e=>e.id===h))||void 0===s?void 0:s.component)||ey;return(0,o.jsxs)(g.aF,{isOpen:i,onClose:l,size:"4xl",isCentered:!0,children:[(0,o.jsx)(m.m,{backdropFilter:"blur(4px)"}),(0,o.jsxs)(f.$,{borderRadius:"xl",maxH:"85vh",children:[(0,o.jsx)(b.r,{borderBottomWidth:"1px",children:"Settings"}),(0,o.jsx)(_.c,{p:0,overflowY:"auto",children:(0,o.jsxs)(I.s,{minH:"600px",children:[(0,o.jsx)(t.a,{w:"240px",borderRightWidth:"1px",p:6,children:(0,o.jsx)(c.T,{spacing:2,align:"stretch",children:eC.map(e=>(0,o.jsx)(t.a,{py:2,px:4,cursor:"pointer",borderRadius:"md",bg:h===e.id?"gray.100":"transparent",_hover:{bg:h===e.id?"gray.100":"gray.50"},onClick:()=>u(e.id),children:(0,o.jsx)(j.E,{fontSize:"sm",fontWeight:h===e.id?"semibold":"normal",color:h===e.id?"black":"gray.600",children:e.label})},e.id))})}),(0,o.jsx)(t.a,{flex:1,p:8,children:(0,o.jsx)(x,{socket:r,isGuest:a})})]})}),(0,o.jsx)(E.j,{borderTopWidth:"1px",children:(0,o.jsx)(d.$,{variant:"ghost",onClick:l,children:"Close"})})]})]})}function eS(){let[e,s]=(0,n.useState)([]),[i,h]=(0,n.useState)(),[u,x]=(0,n.useState)(),[p,j]=(0,n.useState)(),[g,m]=(0,n.useState)(),[f,b]=(0,n.useState)(!1),[v,_]=(0,n.useState)({clientId:"default-user",isGuest:!1}),{isOpen:y,onOpen:C,onClose:w}=(0,l.j)(),{isOpen:S,onOpen:k,onClose:E}=(0,l.j)(),{isOpen:O,onOpen:z,onClose:D}=(0,l.j)(),{isOpen:P,onOpen:R,onClose:A}=(0,l.j)(),{isOpen:I,onOpen:L,onClose:J}=(0,l.j)(),K=M(v),U=(0,r.d)();!function(e){let{socket:s,toast:i,setPolicies:o}=e;(0,n.useEffect)(()=>{if(!s)return;s.emit("getPolicies");let e=["policies","policies_after_save","policies_after_delete"];e.forEach(e=>{s.on(e,s=>{o(s),"policies"!==e&&i({title:"Success",description:{policies_after_save:"Policy saved successfully",policies_after_delete:"Policy deleted successfully"}[e],status:"success",duration:3e3,isClosable:!0})})});let n={connect_error:"Failed to connect to server",error_saving_policy:"Failed to save policy",error_deleting_policy:"Failed to delete policy",error_interrupting_download:"Failed to interrupt download",authentication_failed:"Authentication failed"};Object.entries(n).forEach(e=>{let[o,n]=e;s.on(o,e=>{let s=(null==e?void 0:e.error)||(null==e?void 0:e.message)||"",o=(null==e?void 0:e.policy_name)?' "'.concat(e.policy_name,'"'):"";i({title:"Error",description:"".concat(n).concat(o).concat(s?": "+s:""),status:"error",duration:5e3,isClosable:!0})})}),s.on("download_failed",e=>{let{policy:s,error:o,logs:n}=e;l(s),n&&r(s.name,n),i({title:"Error",description:'Error downloading photos for policy "'.concat(s.name,'": ').concat(o),status:"error",duration:5e3,isClosable:!0})}),s.on("authenticated",e=>{let{msg:s,policies:n}=e;i({title:"Authentication Successful",description:s,status:"success",duration:3e3,isClosable:!0}),o(n)}),s.on("mfa_required",e=>{i({title:"MFA Required",description:e,status:"info",duration:3e3,isClosable:!0})}),s.on("icloud_is_busy",e=>{i({title:"iCloud Account Busy",description:e,status:"info",duration:5e3,isClosable:!0})});let l=e=>{o(s=>s.map(s=>s.name===e.name?{...s,...e}:s))},r=(e,s)=>{o(i=>i.map(i=>i.name===e?{...i,logs:(i.logs||"")+s}:i))};return s.on("download_progress",e=>{let{policy:s,logs:i}=e;l(s),i&&r(s.name,i)}),s.on("download_finished",e=>{let{policy_name:s,progress:o,logs:n}=e;l({name:s,progress:o,status:"stopped"}),n&&r(s,n),i({title:"Download Complete",description:'Successfully downloaded photos for policy "'.concat(s,'"'),status:"success",duration:5e3,isClosable:!0})}),()=>{e.forEach(e=>s.off(e)),Object.keys(n).forEach(e=>s.off(e)),s.off("authenticated"),s.off("mfa_required"),s.off("download_progress"),s.off("download_finished"),s.off("download_failed"),s.off("icloud_is_busy")}},[s,i,o])}({socket:K,toast:U,setPolicies:s}),(0,n.useEffect)(()=>{if(!K)return;let e=()=>{D(),A()},s=e=>{D(),m(e),R()},i=()=>{b(!0)};return K.on("authenticated",e),K.on("mfa_required",s),K.on("server_authenticated",i),()=>{K.off("authenticated",e),K.off("mfa_required",s),K.off("server_authenticated",i)}},[K,p,D,A,R]);let N=()=>{h(void 0),w()};return f?(0,o.jsxs)(t.a,{bg:"gray.200",minH:"100vh",children:[(0,o.jsx)(T,{onSettingsClick:L}),(0,o.jsxs)(a.m,{maxW:"container.xl",py:8,children:[(0,o.jsx)(c.T,{spacing:8,align:"center",width:"100%",children:(0,o.jsx)(t.a,{width:"100%",children:(0,o.jsx)($,{title:"Policies",headerRight:(0,o.jsx)(d.$,{bg:"black",color:"white",_hover:{bg:"gray.800"},borderRadius:"xl",fontFamily:"Inter, sans-serif",fontSize:"12px",size:"sm",px:4,onClick:()=>{h(void 0),C()},children:"Add"}),children:(0,o.jsx)(eu,{policies:e,setPolicies:s,onEdit:e=>{h(e),C()},onDelete:e=>{x(e),k()},onRun:e=>{K&&(e.authenticated?(e.logs="",K.emit("start",e.name)):(j(e),z()))},onInterrupt:e=>{K&&K.emit("interrupt",e.name)},socket:K,toast:U})})})}),y&&(0,o.jsx)(F,{isOpen:!0,onClose:N,onPolicySaved:e=>{s(e),N()},isEditing:!!i,policy:i}),S&&(0,o.jsx)(W,{isOpen:S,onClose:E,onConfirm:()=>{u&&(null==K||K.emit("deletePolicy",u.name),E(),x(void 0))},policyName:(null==u?void 0:u.name)||""}),O&&(0,o.jsx)(em,{isOpen:!0,onClose:()=>{D(),j(void 0)},onSubmit:e=>{K&&p&&K.emit("authenticate",p.name,e)},username:(null==p?void 0:p.username)||"",socket:K}),P&&(0,o.jsx)(ef,{isOpen:!0,onClose:()=>{A(),j(void 0),m(void 0)},onSubmit:e=>{K&&p&&(m(void 0),K.emit("provideMFA",p.name,e))},error:g,socket:K}),I&&(0,o.jsx)(ew,{isOpen:!0,onClose:J,socket:K,isGuest:v.isGuest})]})]}):(0,o.jsx)(e_,{isOpen:!0,socket:K,onAuthenticated:(e,s)=>{_({clientId:e,isGuest:s}),b(!0)}})}}},e=>{var s=s=>e(e.s=s);e.O(0,[897,506,711,873,647,821,441,517,358],()=>s(4032)),_N_E=e.O()}]);